<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <!-- Use title if it's in the page YAML frontmatter -->
    <title>Controller & Routes - Skinny Framework</title>
    <script type="text/javascript" src="/javascripts/jquery-1.11.0.min.js"></script>
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css"/>
    <link href="/stylesheets/all.css" rel="stylesheet" type="text/css" />
    <script src="/javascripts/all.js" type="text/javascript"></script>
  </head>
  <body>
    <div class="container">
    <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
<a href="https://github.com/skinny-framework/skinny-framework"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"></a>
      <div class="container">
        <div class="navbar-header">
          <a class="navbar-brand" href="/"><b>Skinny Framework</b> <span class="subtitle">- Rapid Development in Scala -</span></a>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li class="dropdown">
              <a href="/documentation" class="dropdown-toggle" data-toggle="dropdown">Documentation&nbsp;<b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a href="/documentation/getting-started.html">Getting Started</a></li>
                <li><a href="/documentation/scaffolding.html">Scaffolding</a></li>
                <li><a href="/documentation/controller-and-routes.html">Controller & Routes</a></li>
                <li><a href="/documentation/validator.html">Validator</a></li>
                <li><a href="/documentation/view-templates.html">View Templates</a></li>
                <li><a href="/documentation/assets.html">Assets Support</a></li>
                <li><a href="/documentation/mail.html">Mail</a></li>
                <li><a href="/documentation/worker_jobs.html">Worker Jobs</a></li>
                <li><a href="/documentation/i18n.html">i18n</a></li>
                <li><a href="/documentation/orm.html">O/R Mapper</a></li>
                <li><a href="/documentation/factory-girl.html">FactoryGirl</a></li>
                <li><a href="/documentation/db-migration.html">DB Migration</a></li>
                <li><a href="/documentation/json.html">Working with JSON</a></li>
                <li><a href="/documentation/http-client.html">HTTP Client</a></li>
                <li><a href="/documentation/dependency-injection.html">Dependency Injection</a></li>
                <li><a href="/documentation/tasks.html">Tasks</a></li>
                <li><a href="/documentation/testing.html">Testing</a></li>
                <li><a href="/documentation/packaging.html">Packaging</a></li>
                <li><a href="/documentation/community.html">Community</a></li>
                <li><a href="/contribution.html">Contribution</a></li>
              </ul>
            </li>
            <li><a href="https://github.com/skinny-framework/skinny-framework">Source Code on GitHub</a></li>
            <li><a href="https://groups.google.com/forum/#!forum/skinny-framework">Users ML <small>(Google Group)</small></a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>
    <hr/>
        <div class="col-sm-12">
          <div class="content">
            <h2 id="controller-&amp;-routes">Controller &amp; Routes</h2>

<hr/>

<p>Skinny&rsquo;s routing mechanism and controller layer on MVC architecture can be thought of as a <strong>rich Scalatra</strong>. </p>

<p>Skinny&rsquo;s extensions provide you with much simpler and richer syntax. Of course, if you need to use Scalatra&rsquo;s API directly, Skinny never bothers you.</p>

<p><img alt="Scalatra" src="/images/scalatra.png" /></p>

<p><code>SkinnyController</code> is a trait which extends <code>ScalatraFilter</code> and includes various useful components out-of-the-box.</p>
<pre class="highlight scala"><span class="c1">// src/main/scala/controller/MembersController.scala
</span><span class="k">class</span> <span class="nc">MembersController</span> <span class="k">extends</span> <span class="nc">SkinnyController</span> <span class="o">{</span>
  <span class="n">protectFromForgery</span><span class="o">()</span> <span class="c1">// CSRF protection enabled
</span>
  <span class="k">def</span> <span class="n">index</span> <span class="k">=</span> <span class="o">{</span>
    <span class="c1">// set 'members' in the request scope, then you can use it in views
</span>    <span class="n">set</span><span class="o">(</span><span class="s">"members"</span> <span class="o">-&gt;</span> <span class="nc">Member</span><span class="o">.</span><span class="n">findAll</span><span class="o">())</span>
    <span class="n">render</span><span class="o">(</span><span class="s">"/members/index"</span><span class="o">)</span>
  <span class="o">}</span>

  <span class="k">def</span> <span class="n">newOne</span> <span class="k">=</span> <span class="n">render</span><span class="o">(</span><span class="s">"/members/new"</span><span class="o">)</span>

  <span class="k">def</span> <span class="n">createForm</span> <span class="k">=</span> <span class="n">validation</span><span class="o">(</span><span class="n">params</span><span class="o">,</span>
    <span class="n">paramKey</span><span class="o">(</span><span class="s">"name"</span><span class="o">)</span> <span class="n">is</span> <span class="n">required</span> <span class="o">&amp;</span> <span class="n">minLength</span><span class="o">(</span><span class="mi">2</span><span class="o">),</span>
    <span class="n">paramKey</span><span class="o">(</span><span class="s">"countryId"</span><span class="o">)</span> <span class="n">is</span> <span class="n">numeric</span>
  <span class="o">)</span>

  <span class="k">def</span> <span class="n">createFormParams</span> <span class="k">=</span> <span class="n">params</span><span class="o">.</span><span class="n">permit</span><span class="o">(</span>
    <span class="s">"name"</span> <span class="o">-&gt;</span> <span class="nc">ParamType</span><span class="o">.</span><span class="nc">String</span><span class="o">,</span> 
    <span class="s">"countryId"</span> <span class="o">-&gt;</span> <span class="nc">ParamType</span><span class="o">.</span><span class="nc">Long</span><span class="o">)</span>

  <span class="k">def</span> <span class="n">create</span> <span class="k">=</span> <span class="k">if</span> <span class="o">(</span><span class="n">createForm</span><span class="o">.</span><span class="n">validate</span><span class="o">())</span> <span class="o">{</span>
    <span class="nc">Member</span><span class="o">.</span><span class="n">createWithPermittedAttributes</span><span class="o">(</span><span class="n">createFormParams</span><span class="o">)</span>
    <span class="n">redirect</span><span class="o">(</span><span class="s">"/members"</span><span class="o">)</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="n">render</span><span class="o">(</span><span class="s">"/members/new"</span><span class="o">)</span>
  <span class="o">}</span>

  <span class="c1">// searches both query params and path params
</span>  <span class="k">def</span> <span class="n">show</span> <span class="k">=</span> <span class="n">params</span><span class="o">.</span><span class="n">getAs</span><span class="o">[</span><span class="kt">Long</span><span class="o">](</span><span class="s">"id"</span><span class="o">).</span><span class="n">map</span> <span class="o">{</span> <span class="n">id</span> <span class="k">=&gt;</span>
    <span class="nc">Member</span><span class="o">.</span><span class="n">findById</span><span class="o">(</span><span class="n">id</span><span class="o">).</span><span class="n">map</span> <span class="o">{</span> <span class="n">member</span> <span class="k">=&gt;</span>
      <span class="n">set</span><span class="o">(</span><span class="s">"member"</span> <span class="o">-&gt;</span> <span class="n">member</span><span class="o">)</span>
    <span class="o">}.</span><span class="n">getOrElse</span> <span class="n">haltWithBody</span><span class="o">(</span><span class="mi">404</span><span class="o">)</span>
  <span class="o">}.</span><span class="n">getOrElse</span> <span class="n">haltWithBody</span><span class="o">(</span><span class="mi">404</span><span class="o">)</span>

<span class="o">}</span>

<span class="c1">// src/main/scala/controller/Controllers.scala
</span><span class="k">object</span> <span class="nc">Controllers</span> <span class="o">{</span>
  <span class="k">object</span> <span class="nc">members</span> <span class="k">extends</span> <span class="nc">MembersController</span> <span class="k">with</span> <span class="nc">Routes</span> <span class="o">{</span>
    <span class="k">val</span> <span class="n">indexUrl</span> <span class="k">=</span> <span class="n">get</span><span class="o">(</span><span class="s">"/members/?"</span><span class="o">)(</span><span class="n">index</span><span class="o">).</span><span class="n">as</span><span class="o">(</span><span class="ss">'index)</span>
    <span class="k">val</span> <span class="n">newUrl</span> <span class="k">=</span> <span class="n">get</span><span class="o">(</span><span class="s">"/members/new"</span><span class="o">)(</span><span class="n">newOne</span><span class="o">).</span><span class="n">as</span><span class="o">(</span><span class="ss">'new)</span>
    <span class="k">val</span> <span class="n">createUrl</span> <span class="k">=</span> <span class="n">post</span><span class="o">(</span><span class="s">"/members/?"</span><span class="o">)(</span><span class="n">create</span><span class="o">).</span><span class="n">as</span><span class="o">(</span><span class="ss">'create)</span>
    <span class="k">val</span> <span class="n">showUrl</span> <span class="k">=</span> <span class="n">get</span><span class="o">(</span><span class="s">"/members/:id"</span><span class="o">)(</span><span class="n">show</span><span class="o">).</span><span class="n">as</span><span class="o">(</span><span class="ss">'show)</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// src/main/scala/ScalatraBootstrap.scala
</span><span class="k">class</span> <span class="nc">ScalatraBootstrap</span> <span class="n">exntends</span> <span class="nc">SkinnyLifeCycle</span> <span class="o">{</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">initSkinnyApp</span><span class="o">(</span><span class="n">ctx</span><span class="k">:</span> <span class="kt">ServletContext</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// register routes
</span>    <span class="nc">Controllers</span><span class="o">.</span><span class="n">members</span><span class="o">.</span><span class="n">mount</span><span class="o">(</span><span class="n">ctx</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre>

<p><code>#render</code> expects <code>src/main/webapp/WEB-INF/views/members/index.html.ssp</code> by default.</p>
<pre class="highlight plaintext">render("/members/index")
</pre>
<pre class="highlight plaintext">&lt;!-- src/main/webapp/WEB-INF/views/members/index.html.ssp --&gt;
&lt;%@val members: Seq[Member]%&gt;
&lt;ul&gt;
#for (member &lt;- members)
  &lt;li&gt;${member.name}&lt;/li&gt;
#end
&lt;ul&gt;
</pre>

<hr/>

<h3 id="reverse-routes">Reverse Routes</h3>

<hr/>

<p>You can use Scalatra&rsquo;s reverse routes.</p>

<p><a href="http://www.scalatra.org/2.2/guides/http/reverse-routes.html">http://www.scalatra.org/2.2/guides/http/reverse-routes.html</a></p>

<p>In controllers:</p>
<pre class="highlight scala"><span class="k">class</span> <span class="nc">MembersController</span> <span class="k">extends</span> <span class="nc">SkinnyController</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">oldPage</span> <span class="k">=</span> <span class="n">redirect</span><span class="o">(</span><span class="n">url</span><span class="o">(</span><span class="nc">Controllers</span><span class="o">.</span><span class="n">members</span><span class="o">.</span><span class="n">indexUrl</span><span class="o">))</span>
<span class="o">}</span>

<span class="k">object</span> <span class="nc">Controllers</span> <span class="o">{</span>
  <span class="k">object</span> <span class="nc">members</span> <span class="k">extends</span> <span class="nc">MembersController</span> <span class="k">with</span> <span class="nc">Routes</span> <span class="o">{</span>
    <span class="k">val</span> <span class="n">indexUrl</span> <span class="k">=</span> <span class="n">get</span><span class="o">(</span><span class="s">"/members/?"</span><span class="o">)(</span><span class="n">index</span><span class="o">).</span><span class="n">as</span><span class="o">(</span><span class="ss">'index)</span>
    <span class="k">val</span> <span class="n">showUrl</span> <span class="k">=</span> <span class="n">get</span><span class="o">(</span><span class="s">"/members/:id"</span><span class="o">)(</span><span class="n">show</span><span class="o">).</span><span class="n">as</span><span class="o">(</span><span class="ss">'show)</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre>

<p>In views:</p>
<pre class="highlight plaintext">// Jade example
a(href={s.url(Controllers.members.showUrl, "id" -&gt; member.id)}) Show detail

</pre>

<p>FYI: You can see more examples for SkinnyResource by generating scaffold views.</p>

<hr/>

<h3 id="skinnycontroller-&amp;-skinnyservlet">SkinnyController &amp; SkinnyServlet</h3>

<hr/>

<p>There are the two controller base traits. SkinnyController is a ScalatraFilter. SkinnyServlet is a ScalatraServlet.</p>

<ul>
<li><a href="(http://www.scalatra.org/2.2/api/index.html#org.scalatra.ScalatraFilter)">org.scalatra.ScalatraFilter</a></li>
<li><a href="(http://www.scalatra.org/2.2/api/index.html#org.scalatra.ScalatraServlet)">org.scalatra.ScalatraServlet</a></li>
</ul>

<p>In general SkinnyController is more suitable for Skinny framework based applications.</p>

<p>However, if you really need to use a ScalatraServlet instead of a filter, use SkinnyServlet.</p>

<hr/>

<h3 id="skinnyresource">SkinnyResource</h3>

<hr/>

<p>SkinnyResource is a useful base trait for RESTful web services. SkinnyResource is very similar to Rails ActiveResource.</p>

<p><a href="http://guides.rubyonrails.org/routing.html#resource-routing-the-rails-default">Resource Routing: the Rails Default (Rails Routing from the Outside In — Ruby on Rails Guides)</a></p>

<p><a href="https://github.com/rails/activeresource">https://github.com/rails/activeresource</a></p>

<p>SkinnyResource is also useful as a controller sample. If you&rsquo;re a Skinny beginner, take a look at its code.</p>

<p><a href="https://github.com/skinny-framework/skinny-framework/blob/1.1.x/framework/src/main/scala/skinny/controller/SkinnyResource.scala">framework/src/main/scala/skinny/controller/SkinnyResource.scala</a></p>

<p>SkinnyResourceActions has action methods for the resource and SkinnyResourceRoutes defines routings for the resource.
If you&rsquo;d like to customize routings (e.g. use only creation and deletion), just mixin only SkinnyResourceActions and define routings by yourself.</p>

<p>You can see a SkinnyResource example using the scaffolding generator.</p>
<pre class="highlight plaintext">./skinny g scaffold members member name:String birthday:LocalDate
</pre>

<p>Then you get the following code. If you need to customize, override some parts of SkinnyResource:</p>

<p><a href="https://github.com/skinny-framework/skinny-framework/blob/1.1.x/framework/src/main/scala/skinny/controller/SkinnyResource.scala">framework/src/main/scala/skinny/controller/SkinnyResource.scala</a></p>
<pre class="highlight scala"><span class="k">package</span> <span class="nn">controller</span>

<span class="k">import</span> <span class="nn">skinny._</span>
<span class="k">import</span> <span class="nn">skinny.validator._</span>
<span class="k">import</span> <span class="nn">model.Member</span>

<span class="k">object</span> <span class="nc">MembersController</span> <span class="k">extends</span> <span class="nc">SkinnyResource</span> <span class="o">{</span>
  <span class="n">protectFromForgery</span><span class="o">()</span> <span class="c1">// CSRF protection
</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">model</span> <span class="k">=</span> <span class="nc">Member</span> <span class="c1">// SkinnyModel for this controller
</span>  <span class="k">override</span> <span class="k">def</span> <span class="n">resourcesName</span> <span class="k">=</span> <span class="s">"members"</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">resourceName</span> <span class="k">=</span> <span class="s">"member"</span>

  <span class="c1">// parameters &amp; validations for creation
</span>  <span class="k">override</span> <span class="k">def</span> <span class="n">createParams</span> <span class="k">=</span> <span class="nc">Params</span><span class="o">(</span><span class="n">params</span><span class="o">).</span><span class="n">withDate</span><span class="o">(</span><span class="s">"birthday"</span><span class="o">)</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">createForm</span> <span class="k">=</span> <span class="n">validation</span><span class="o">(</span><span class="n">createParams</span><span class="o">,</span>
    <span class="n">paramKey</span><span class="o">(</span><span class="s">"name"</span><span class="o">)</span> <span class="n">is</span> <span class="n">required</span> <span class="o">&amp;</span> <span class="n">maxLength</span><span class="o">(</span><span class="mi">512</span><span class="o">),</span>
    <span class="n">paramKey</span><span class="o">(</span><span class="s">"birthday"</span><span class="o">)</span> <span class="n">is</span> <span class="n">required</span> <span class="o">&amp;</span> <span class="n">dateFormat</span>
  <span class="o">)</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">createFormStrongParameters</span> <span class="k">=</span> <span class="nc">Seq</span><span class="o">(</span>
    <span class="s">"name"</span> <span class="o">-&gt;</span> <span class="nc">ParamType</span><span class="o">.</span><span class="nc">String</span><span class="o">,</span>
    <span class="s">"birthday"</span> <span class="o">-&gt;</span> <span class="nc">ParamType</span><span class="o">.</span><span class="nc">LocalDate</span>
  <span class="o">)</span>

  <span class="c1">// parameters &amp; validations for modification
</span>  <span class="k">override</span> <span class="k">def</span> <span class="n">updateParams</span> <span class="k">=</span> <span class="nc">Params</span><span class="o">(</span><span class="n">params</span><span class="o">).</span><span class="n">withDate</span><span class="o">(</span><span class="s">"birthday"</span><span class="o">)</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">updateForm</span> <span class="k">=</span> <span class="n">validation</span><span class="o">(</span><span class="n">updateParams</span><span class="o">,</span>
    <span class="n">paramKey</span><span class="o">(</span><span class="s">"name"</span><span class="o">)</span> <span class="n">is</span> <span class="n">required</span> <span class="o">&amp;</span> <span class="n">maxLength</span><span class="o">(</span><span class="mi">512</span><span class="o">),</span>
    <span class="n">paramKey</span><span class="o">(</span><span class="s">"birthday"</span><span class="o">)</span> <span class="n">is</span> <span class="n">required</span> <span class="o">&amp;</span> <span class="n">dateFormat</span>
  <span class="o">)</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">updateFormStrongParameters</span> <span class="k">=</span> <span class="nc">Seq</span><span class="o">(</span>
    <span class="s">"name"</span> <span class="o">-&gt;</span> <span class="nc">ParamType</span><span class="o">.</span><span class="nc">String</span><span class="o">,</span>
    <span class="s">"birthday"</span> <span class="o">-&gt;</span> <span class="nc">ParamType</span><span class="o">.</span><span class="nc">LocalDate</span>
  <span class="o">)</span>

<span class="o">}</span>
</pre>

<p>Required view templates:</p>
<pre class="highlight plaintext">src/main/webapp/WEB-INF/views/members/
├── _form.html.ssp
├── edit.html.ssp
├── index.html.ssp
├── new.html.ssp
└── show.html.ssp
</pre>

<p>In this case, SkinnyResource provides the following URLs by default.</p>

<ul>
<li>GET /members</li>
<li>GET /members/</li>
<li>GET /members.xml</li>
<li>GET /members.json</li>
<li>GET /members/new</li>
<li>POST /members</li>
<li>POST /members.xml</li>
<li>POST /members.json</li>
<li>POST /members/</li>
<li>GET /members/{id}</li>
<li>GET /members/{id}.xml</li>
<li>GET /members/{id}.json</li>
<li>GET /members/{id}/edit</li>
<li>POST /members/{id}.xml</li>
<li>POST /members/{id}.json</li>
<li>POST /members/{id}</li>
<li>PUT /members/{id}.xml</li>
<li>PUT /members/{id}.json</li>
<li>PUT /members/{id}</li>
<li>PATCH /members/{id}.xml</li>
<li>PATCH /members/{id}.json</li>
<li>PATCH /members/{id}</li>
<li>DELETE /members/{id}.xml</li>
<li>DELETE /members/{id}.json</li>
<li>DELETE /members/{id}</li>
</ul>

<hr/>

<h3 id="skinny.skinny">skinny.Skinny</h3>

<hr/>

<p>skinny.Skinny provides getters for basic elements in view templates.</p>
<pre class="highlight plaintext">&lt;%@val s: skinny.Skinny %&gt;
</pre>

<p><a href="https://github.com/skinny-framework/skinny-framework/blob/1.1.x/framework/src/main/scala/skinny/Skinny.scala">framework/src/main/scala/skinny/Skinny.scala</a></p>

<ul>
<li>params: Params</li>
<li>multiParams: MultiParams</li>
<li>flash: Flash</li>
<li>errorMessages: Seq[String]</li>
<li>keyAndErrorMessages: Map[String, Seq[String]]</li>
<li>contextPath: String</li>
<li>requestPath: String</li>
<li>requestPathWithQueryString: String</li>
<li>csrfKey: String</li>
<li>csrfToken: String</li>
<li>csrfMetaTag(s): String</li>
<li>csrfHiddenInputTag: String</li>
<li>i18n: I18n</li>
</ul>

<hr/>

<h3 id="beforeaction/afteraction-filters">beforeAction/afterAction Filters</h3>

<hr/>

<p>Scalatra has before/after filters by default, but we recommend Skinny users to use Skinny&rsquo;s beforeAction/afterAction filters.</p>

<p>The reason is that Scalatra&rsquo;s filters might affect other controllers that are defined further down in ScalatraBootstrap.scala and it&rsquo;s not easy to figure out where each controller&rsquo;s before/after affects completely.</p>

<p>So if you need filters that are similar to Rails filters, just use Skinny filters.</p>

<h5 id="scalatra&#39;s-before/after-filters">Scalatra&rsquo;s before/after filters</h5>

<p><a href="http://www.scalatra.org/2.2/api/index.html#org.scalatra.ScalatraBase">/api/index.html#org.scalatra.ScalatraBase</a></p>

<ul>
<li>before(transformers)(action)</li>
<li>after(transformers)(action)</li>
</ul>

<h5 id="skinny&#39;s-beforeaction/afteraction-filters">Skinny&rsquo;s beforeAction/afterAction filters</h5>

<p><a href="https://github.com/skinny-framework/skinny-framework/blob/1.1.x/framework/src/main/scala/skinny/controller/feature/BeforeAfterActionFeature.scala">/framework/src/main/scala/skinny/controller/feature/BeforeAfterActionFeature.scala</a></p>
<pre class="highlight scala"><span class="k">class</span> <span class="nc">MembersController</span> <span class="k">extends</span> <span class="nc">SkinnyController</span> <span class="k">with</span> <span class="nc">Routes</span> <span class="o">{</span>

  <span class="c1">// Scalatra filters
</span>  <span class="n">before</span><span class="o">()</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span> <span class="c1">// might affect other controllers
</span>  <span class="n">after</span><span class="o">()</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>

  <span class="c1">// Skinny filters
</span>  <span class="n">beforeAction</span><span class="o">(</span><span class="n">only</span> <span class="k">=</span> <span class="nc">Seq</span><span class="o">(</span><span class="ss">'index,</span> <span class="ss">'new)</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">println</span><span class="o">(</span><span class="s">"before"</span><span class="o">)</span>
  <span class="o">}</span>
  <span class="n">afterAction</span><span class="o">(</span><span class="n">except</span> <span class="k">=</span> <span class="nc">Seq</span><span class="o">(</span><span class="ss">'new)</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">println</span><span class="o">(</span><span class="s">"after"</span><span class="o">)</span>
  <span class="o">}</span>

  <span class="c1">//actions
</span>  <span class="k">def</span> <span class="n">index</span> <span class="k">=</span> <span class="o">...</span>
  <span class="k">def</span> <span class="n">newInput</span> <span class="k">=</span> <span class="o">...</span>
  <span class="k">def</span> <span class="n">edit</span> <span class="k">=</span> <span class="o">...</span>

  <span class="c1">// routes
</span>  <span class="n">get</span><span class="o">(</span><span class="s">"/members/?"</span><span class="o">)(</span><span class="n">index</span><span class="o">).</span><span class="n">as</span><span class="o">(</span><span class="ss">'index)</span>      <span class="c1">// before, after
</span>  <span class="n">get</span><span class="o">(</span><span class="s">"/members/new"</span><span class="o">)(</span><span class="n">newInput</span><span class="o">).</span><span class="n">as</span><span class="o">(</span><span class="ss">'new)</span>   <span class="c1">// before
</span>  <span class="n">get</span><span class="o">(</span><span class="s">"/members/:id/edit"</span><span class="o">)(</span><span class="n">edit</span><span class="o">).</span><span class="n">as</span><span class="o">(</span><span class="ss">'edit)</span> <span class="c1">// after
</span>
<span class="o">}</span>
</pre>

<hr/>

<h3 id="skinnyfilter">SkinnyFilter</h3>

<hr/>

<p>SkinnyFilter is our original filter to enable easily handling before/after/error for each controller. You can apply the same beforeAction/afterAction/error filters to several controllers by just mixing in SkinnyFilter-based traits.</p>

<p>Contrary to your expectations, Scalatra doesn&rsquo;t run all the handlers for after and error. Only the first one would be applied and the others are just ignored. We think it&rsquo;s difficult to be aware of this specification (it&rsquo;s not a bug but by design). So SkinnyFilter&rsquo;s before/after/error handlers are always applied. </p>

<p>For instance, in skinny-blank-app, ErrrorPageFilter is applied to ApplicationController. </p>
<pre class="highlight scala"><span class="k">trait</span> <span class="nc">ApplicationController</span> <span class="k">extends</span> <span class="nc">SkinnyController</span>
  <span class="k">with</span> <span class="nc">ErrorPageFilter</span> <span class="o">{</span>

<span class="o">}</span>
</pre>

<p>ErrorPageFilter is as follows. It&rsquo;s pretty easy to customize such a filter (e.g. adding error notification) as follows.</p>
<pre class="highlight scala"><span class="k">trait</span> <span class="nc">ErrorPageFilter</span> <span class="k">extends</span> <span class="nc">SkinnyRenderingFilter</span> <span class="o">{</span>
  <span class="c1">// appends error filter in order
</span>  <span class="n">addRenderingErrorFilter</span> <span class="o">{</span>
    <span class="k">case</span> <span class="n">e</span><span class="k">:</span> <span class="kt">Throwable</span> <span class="o">=&gt;</span>
      <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="n">getMessage</span><span class="o">,</span> <span class="n">e</span><span class="o">)</span>
      <span class="k">try</span> <span class="o">{</span>
        <span class="n">status</span> <span class="k">=</span> <span class="mi">500</span>
        <span class="n">render</span><span class="o">(</span><span class="s">"/error/500"</span><span class="o">)</span>
      <span class="o">}</span> <span class="k">catch</span> <span class="o">{</span>
        <span class="k">case</span> <span class="n">e</span><span class="k">:</span> <span class="kt">Exception</span> <span class="o">=&gt;</span> <span class="k">throw</span> <span class="n">e</span>
      <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre>

<p>It just outputs error logging, set status as 500 and renders &ldquo;/error/500.html.ssp&rdquo; or similar templates. <code>SkinnyRenderingFilter</code> is a sub-trait of <code>SkinnyFilter</code>. <code>SkinnyFilter</code>&rsquo;s response value is always ignored. But <code>SkinnyRenderingFilter</code> can return a response body like above.</p>

<p>The second example is <code>TxPerRequestFilter</code> which enables you to apply the open-session-in-view pattern to your apps.</p>
<pre class="highlight scala"><span class="k">trait</span> <span class="nc">TxPerRequestFilter</span> <span class="k">extends</span> <span class="nc">SkinnyFilter</span> <span class="k">with</span> <span class="nc">Logging</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">cp</span><span class="k">:</span> <span class="kt">ConnectionPool</span> <span class="o">=</span> <span class="nc">ConnectionPool</span><span class="o">.</span><span class="n">get</span><span class="o">()</span>

  <span class="k">def</span> <span class="n">begin</span> <span class="k">=</span> <span class="o">{</span>
    <span class="k">val</span> <span class="n">db</span> <span class="k">=</span> <span class="nc">ThreadLocalDB</span><span class="o">.</span><span class="n">create</span><span class="o">(</span><span class="n">cp</span><span class="o">.</span><span class="n">borrow</span><span class="o">())</span>
    <span class="n">db</span><span class="o">.</span><span class="n">begin</span><span class="o">()</span>
  <span class="o">}</span>

  <span class="c1">// will handle exceptions occurred in controllers
</span>  <span class="n">addErrorFilter</span> <span class="o">{</span> <span class="k">case</span> <span class="n">e</span><span class="k">:</span> <span class="kt">Throwable</span> <span class="o">=&gt;</span>
    <span class="nc">Option</span><span class="o">(</span><span class="nc">ThreadLocalDB</span><span class="o">.</span><span class="n">load</span><span class="o">()).</span><span class="n">foreach</span> <span class="o">{</span> <span class="n">db</span> <span class="k">=&gt;</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">db</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">db</span><span class="o">.</span><span class="n">isTxNotActive</span><span class="o">)</span> <span class="n">using</span><span class="o">(</span><span class="n">db</span><span class="o">)(</span><span class="k">_</span><span class="o">.</span><span class="n">rollbackIfActive</span><span class="o">())</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="k">def</span> <span class="n">commit</span> <span class="k">=</span> <span class="o">{</span>
    <span class="k">val</span> <span class="n">db</span> <span class="k">=</span> <span class="nc">ThreadLocalDB</span><span class="o">.</span><span class="n">load</span><span class="o">()</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">db</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">db</span><span class="o">.</span><span class="n">isTxNotActive</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">using</span><span class="o">(</span><span class="n">db</span><span class="o">)(</span><span class="k">_</span><span class="o">.</span><span class="n">commit</span><span class="o">())</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="n">beforeAction</span><span class="o">()(</span><span class="n">begin</span><span class="o">)</span>
  <span class="n">afterAction</span><span class="o">()(</span><span class="n">commit</span><span class="o">)</span>
<span class="o">}</span>
</pre>

<hr/>

<h3 id="how-to-do-it?-examples">How to Do It? Examples</h3>

<hr/>

<p>Basically, you will use Scalatra&rsquo;s DSL.</p>

<p><a href="http://www.scalatra.org/2.2/guides/">http://www.scalatra.org/2.2/guides/</a></p>

<p><a href="http://www.scalatra.org/2.2/api/index.html#org.scalatra.ScalatraBase">http://www.scalatra.org/2.2/api/index.html#org.scalatra.ScalatraBase</a></p>

<hr/>

<h4 id="(query/form/path)-parameters">(Query/Form/Path) Parameters</h4>

<hr/>

<h4 id="params">params</h4>
<pre class="highlight scala"><span class="k">val</span> <span class="n">name</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span>
<span class="k">val</span> <span class="n">id</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="n">params</span><span class="o">.</span><span class="n">getAs</span><span class="o">[</span><span class="kt">Int</span><span class="o">](</span><span class="s">"id"</span><span class="o">)</span>
<span class="k">val</span> <span class="n">id</span><span class="k">:</span> <span class="kt">Long</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">getAsOrElse</span><span class="o">[</span><span class="kt">Long</span><span class="o">](</span><span class="s">"id"</span><span class="o">,</span> <span class="o">-</span><span class="mi">1L</span><span class="o">)</span>

<span class="k">val</span> <span class="n">ids</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Seq</span><span class="o">[</span><span class="kt">Int</span><span class="o">]]</span> <span class="k">=</span> <span class="n">multiParams</span><span class="o">.</span><span class="n">getAs</span><span class="o">[</span><span class="kt">Int</span><span class="o">](</span><span class="s">"ids"</span><span class="o">)</span>
</pre>

<p><a href="http://www.scalatra.org/2.2/api/index.html#org.scalatra.ScalatraParams">/api/index.html#org.scalatra.ScalatraParams</a></p>

<p><a href="http://www.scalatra.org/2.2/api/index.html#org.scalatra.ScalatraParamsImplicits$TypedParams">/api/index.html#org.scalatra.ScalatraParamsImplicits$TypedParams</a></p>

<p><a href="http://www.scalatra.org/2.2/api/index.html#org.scalatra.ScalatraParamsImplicits$TypedMultiParams">/api/index.html#org.scalatra.ScalatraParamsImplicits$TypedMultiParams</a></p>

<hr/>

<h4 id="multiparams(&quot;splat&quot;)">multiParams(&ldquo;splat&rdquo;)</h4>
<pre class="highlight scala"><span class="n">get</span><span class="o">(</span><span class="s">"/say/*/to/*"</span><span class="o">)</span> <span class="o">{</span>
  <span class="c1">// Matches "GET /say/hello/to/world"
</span>  <span class="n">multiParams</span><span class="o">(</span><span class="s">"splat"</span><span class="o">)</span> <span class="c1">// == Seq("hello", "world")
</span><span class="o">}</span>

<span class="n">get</span><span class="o">(</span><span class="s">"/download/*.*"</span><span class="o">)</span> <span class="o">{</span>
  <span class="c1">// Matches "GET /download/path/to/file.xml"
</span>  <span class="n">multiParams</span><span class="o">(</span><span class="s">"splat"</span><span class="o">)</span> <span class="c1">// == Seq("path/to/file", "xml")
</span><span class="o">}</span>
</pre>

<p><a href="http://www.scalatra.org/2.2/api/index.html#org.scalatra.ScalatraBase">/api/index.html#org.scalatra.ScalatraBase</a></p>

<p><a href="http://www.scalatra.org/guides/http/routes.html">/guides/http/routes.html</a></p>

<hr/>

<h4 id="multiparams(&quot;captures&quot;)">multiParams(&ldquo;captures&rdquo;)</h4>
<pre class="highlight scala"><span class="n">get</span><span class="o">(</span><span class="s">"""^\/f(.*)/b(.*)"""</span><span class="o">.</span><span class="n">r</span><span class="o">)</span> <span class="o">{</span>
  <span class="c1">// Matches "GET /foo/bar"
</span>  <span class="n">multiParams</span><span class="o">(</span><span class="s">"captures"</span><span class="o">)</span> <span class="c1">// == Seq("oo", "ar")
</span><span class="o">}</span>
</pre>

<p><a href="http://www.scalatra.org/2.2/api/index.html#org.scalatra.ScalatraBase">/api/index.html#org.scalatra.ScalatraBase</a></p>

<p><a href="http://www.scalatra.org/guides/http/routes.html">/guides/http/routes.html</a></p>

<hr/>

<h4 id="cookies">Cookies</h4>

<hr/>
<pre class="highlight scala"><span class="k">def</span> <span class="n">hello</span> <span class="k">=</span> <span class="o">{</span>
  <span class="n">cookies</span> <span class="o">+=</span> <span class="s">"name"</span> <span class="o">-&gt;</span> <span class="s">"value"</span>
  <span class="n">cookies</span> <span class="o">-=</span> <span class="s">"name"</span>
<span class="o">}</span>

<span class="k">def</span> <span class="n">helloWithOptions</span> <span class="k">=</span> <span class="o">{</span>
  <span class="k">implicit</span> <span class="k">val</span> <span class="n">options</span> <span class="k">=</span> <span class="nc">CookieOptions</span><span class="o">(</span><span class="n">secure</span> <span class="k">=</span> <span class="kc">true</span><span class="o">)</span>
  <span class="n">cookies</span><span class="o">.</span><span class="n">set</span><span class="o">(</span><span class="s">"name"</span> <span class="o">-&gt;</span> <span class="s">"value"</span><span class="o">)</span>
  <span class="n">cookies</span><span class="o">.</span><span class="n">set</span><span class="o">(</span><span class="s">"name"</span> <span class="o">-&gt;</span> <span class="s">"value"</span><span class="o">)(</span><span class="n">options</span><span class="o">)</span>
<span class="o">}</span>
</pre>

<p><a href="http://www.scalatra.org/2.2/api/index.html#org.scalatra.SweetCookies">/api/index.html#org.scalatra.SweetCookies</a></p>

<p><a href="http://www.scalatra.org/2.2/api/org/scalatra/CookieOptions.html">/api/org/scalatra/CookieOptions.html</a></p>

<hr/>

<h4 id="request/response-headers">Request/Response Headers</h4>

<hr/>
<pre class="highlight scala"><span class="k">val</span> <span class="n">v</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="n">request</span><span class="o">.</span><span class="n">header</span><span class="o">(</span><span class="n">name</span><span class="o">)</span>
</pre>

<p><a href="http://www.scalatra.org/2.2/api/index.html#org.scalatra.servlet.RichRequest">/api/index.html#org.scalatra.servlet.RichRequest</a></p>
<pre class="highlight scala"><span class="n">response</span><span class="o">.</span><span class="n">headers</span> <span class="o">+=</span> <span class="s">"name"</span> <span class="o">-&gt;</span> <span class="s">"value"</span>
<span class="n">response</span><span class="o">.</span><span class="n">headers</span> <span class="o">-=</span> <span class="s">"name"</span>
</pre>

<p><a href="http://www.scalatra.org/2.2/api/index.html#org.scalatra.servlet.RichResponse">/api/index.html#org.scalatra.servlet.RichResponse</a></p>

<hr/>

<h4 id="session">Session</h4>

<hr/>
<pre class="highlight scala"><span class="k">val</span> <span class="n">v</span><span class="k">:</span> <span class="kt">Any</span> <span class="o">=</span> <span class="n">session</span><span class="o">(</span><span class="s">"name"</span><span class="o">)</span> <span class="c1">// or session('name)
</span><span class="n">session</span> <span class="o">+=</span> <span class="s">"name"</span> <span class="o">-&gt;</span> <span class="s">"value"</span>
<span class="n">session</span> <span class="o">-=</span> <span class="s">"name"</span>
</pre>

<p><a href="http://www.scalatra.org/2.2/api/index.html#org.scalatra.servlet.RichSession">/api/index.html#org.scalatra.servlet.RichSession</a></p>

<p>Even if you don&rsquo;t use sessions in your application code, Scalatra&rsquo;s Flash and CSRF protection features are using servlet sessions.
So your apps are not naturally stateless when using vanilla Scalatra.</p>

<p>We recommend you use SkinnySession to keep your Skinny apps stateless.
When you enable SkinnySession, these features also start using SkinnySession instead of Servlet session attributes.</p>

<p>ScalatraBootstrap.scala:</p>
<pre class="highlight scala"><span class="k">import</span> <span class="nn">scalikejdbc._</span>
<span class="k">import</span> <span class="nn">skinny.session.SkinnySessionInitializer</span>
<span class="k">class</span> <span class="nc">ScalatraBootstrap</span> <span class="k">extends</span> <span class="nc">SkinnyLifeCycle</span> <span class="o">{</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">initSkinnyApp</span><span class="o">(</span><span class="n">ctx</span><span class="k">:</span> <span class="kt">ServletContext</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Database queries will be increased
</span>    <span class="nc">GlobalSettings</span><span class="o">.</span><span class="n">loggingSQLAndTime</span> <span class="k">=</span> <span class="nc">LoggingSQLAndTimeSettings</span><span class="o">(</span>
      <span class="n">singleLineMode</span> <span class="k">=</span> <span class="kc">true</span>
    <span class="o">)</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">mount</span><span class="o">(</span><span class="n">classOf</span><span class="o">[</span><span class="kt">SkinnySessionInitializer</span><span class="o">],</span> <span class="s">"/*"</span><span class="o">)</span>

    <span class="nc">Controllers</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">mount</span><span class="o">(</span><span class="n">ctx</span><span class="o">)</span>
    <span class="nc">AssetsController</span><span class="o">.</span><span class="n">mount</span><span class="o">(</span><span class="n">ctx</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre>

<p>controller/RootController.scala:</p>
<pre class="highlight scala"><span class="k">class</span> <span class="nc">RootController</span> <span class="k">extends</span> <span class="nc">ApplicationController</span> <span class="k">with</span> <span class="nc">SkinnySessionFilter</span> <span class="o">{</span>

  <span class="k">def</span> <span class="n">index</span> <span class="k">=</span> <span class="o">{</span>
    <span class="k">val</span> <span class="n">v</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Any</span><span class="o">]</span> <span class="k">=</span> <span class="n">skinnySession</span><span class="o">.</span><span class="n">getAttribute</span><span class="o">(</span><span class="s">"name"</span><span class="o">)</span>
    <span class="n">skinnySession</span><span class="o">.</span><span class="n">setAttribute</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="s">"value"</span><span class="o">)</span>
    <span class="n">skinnySession</span><span class="o">.</span><span class="n">deleteAttribute</span><span class="o">(</span><span class="s">"name"</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre>

<p>DB migration file:</p>
<pre class="highlight sql"><span class="c1">-- H2 Database compatible
</span><span class="k">create</span> <span class="k">table</span> <span class="n">skinny_sessions</span> <span class="p">(</span>
  <span class="n">id</span> <span class="n">bigserial</span> <span class="k">not</span> <span class="k">null</span> <span class="k">primary</span> <span class="k">key</span><span class="p">,</span>
  <span class="n">created_at</span> <span class="k">timestamp</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="n">expire_at</span> <span class="k">timestamp</span> <span class="k">not</span> <span class="k">null</span>
<span class="p">);</span>
<span class="k">create</span> <span class="k">table</span> <span class="n">servlet_sessions</span> <span class="p">(</span>
  <span class="n">jsession_id</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span> <span class="k">not</span> <span class="k">null</span> <span class="k">primary</span> <span class="k">key</span><span class="p">,</span>
  <span class="n">skinny_session_id</span> <span class="n">bigint</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="n">created_at</span> <span class="k">timestamp</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="k">foreign</span> <span class="k">key</span><span class="p">(</span><span class="n">skinny_session_id</span><span class="p">)</span> <span class="k">references</span> <span class="n">skinny_sessions</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">);</span>
<span class="k">create</span> <span class="k">table</span> <span class="n">skinny_session_attributes</span> <span class="p">(</span>
  <span class="n">skinny_session_id</span> <span class="n">bigint</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="n">attribute_name</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="n">attribute_value</span> <span class="n">bytea</span><span class="p">,</span>
  <span class="k">foreign</span> <span class="k">key</span><span class="p">(</span><span class="n">skinny_session_id</span><span class="p">)</span> <span class="k">references</span> <span class="n">skinny_sessions</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">);</span>
<span class="k">alter</span> <span class="k">table</span> <span class="n">skinny_session_attributes</span> <span class="k">add</span> <span class="k">constraint</span>
  <span class="n">skinny_session_attributes_unique_idx</span>
  <span class="k">unique</span><span class="p">(</span><span class="n">skinny_session_id</span><span class="p">,</span> <span class="n">attribute_name</span><span class="p">);</span>
</pre>

<hr/>

<h4 id="flash">Flash</h4>

<hr/>

<p>Notice: Flash uses servlet sessions by default. Be aware of sticky session mode.</p>
<pre class="highlight scala"><span class="n">flash</span><span class="o">(</span><span class="n">name</span><span class="o">)</span> <span class="k">=</span> <span class="n">value</span>
<span class="n">flash</span> <span class="o">+=</span> <span class="o">(</span><span class="n">name</span> <span class="o">-&gt;</span> <span class="n">value</span><span class="o">)</span>
<span class="n">flash</span><span class="o">.</span><span class="n">now</span> <span class="o">+=</span> <span class="o">(</span><span class="n">name</span> <span class="o">-&gt;</span> <span class="n">value</span><span class="o">)</span>
</pre>

<p><a href="http://www.scalatra.org/guides/http/flash.html">/guides/http/flash.html</a></p>

<p><a href="http://www.scalatra.org/2.2/api/index.html#org.scalatra.FlashMap">/api/index.html#org.scalatra.FlashMap</a></p>

<hr/>

<h4 id="request-body">Request Body</h4>

<hr/>
<pre class="highlight scala"><span class="k">val</span> <span class="n">body</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">body</span>
<span class="k">val</span> <span class="n">stream</span><span class="k">:</span> <span class="kt">InputStream</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">inputStream</span> <span class="c1">// raw HTTP POST data
</span></pre>

<p><a href="http://www.scalatra.org/2.2/api/index.html#org.scalatra.servlet.RichRequest">/api/index.html#org.scalatra.servlet.RichRequest</a></p>

<hr/>

<h4 id="file-upload">File Upload</h4>

<hr/>

<div class="alert alert-warning small">
<b>WARNING:</b> Extend not SkinnyController but SkinnyServlet. You cannot use FileUploadFeature with SkinnyController.
</div>
<pre class="highlight scala"><span class="k">import</span> <span class="nn">skinny.SkinnyServlet</span>
<span class="k">import</span> <span class="nn">skinny.controller.feature.FileUploadFeature</span>

<span class="c1">// SkinnySerlvet!!!
</span><span class="k">class</span> <span class="nc">FilesController</span> <span class="k">extends</span> <span class="nc">SkinnyServlet</span> <span class="k">with</span> <span class="nc">FileUploadFeature</span> <span class="o">{</span>

  <span class="k">def</span> <span class="n">upload</span> <span class="k">=</span> <span class="n">fileParams</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="s">"file"</span><span class="o">)</span> <span class="k">match</span> <span class="o">{</span>
    <span class="k">case</span> <span class="nc">Some</span><span class="o">(</span><span class="n">file</span><span class="o">)</span> <span class="k">=&gt;</span>
      <span class="nc">Ok</span><span class="o">(</span><span class="n">file</span><span class="o">.</span><span class="n">get</span><span class="o">(),</span> <span class="nc">Map</span><span class="o">(</span>
        <span class="s">"Content-Type"</span>        <span class="o">-&gt;</span> <span class="o">(</span><span class="n">file</span><span class="o">.</span><span class="n">contentType</span><span class="o">.</span><span class="n">getOrElse</span><span class="o">(</span><span class="s">"application/octet-stream"</span><span class="o">)),</span>
        <span class="s">"Content-Disposition"</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="s">"attachment; filename=\""</span> <span class="o">+</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s">"\""</span><span class="o">)</span>
      <span class="o">))</span>
    <span class="k">case</span> <span class="nc">None</span> <span class="k">=&gt;</span>
      <span class="nc">BadRequest</span><span class="o">(</span><span class="n">displayPage</span><span class="o">(</span>
        <span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>
          <span class="nc">Hey</span><span class="o">!</span> <span class="nc">You</span> <span class="n">forgot</span> <span class="n">to</span> <span class="n">select</span> <span class="n">a</span> <span class="n">file</span><span class="o">.</span>
        <span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;))</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre>

<p><a href="http://www.scalatra.org/guides/formats/upload.html">/guides/formats/upload.html</a></p>

<p><a href="http://www.scalatra.org/2.2/api/index.html#org.scalatra.fileupload.FileUploadSupport">/api/index.html#org.scalatra.fileupload.FileUploadSupport</a></p>

<hr/>

<h4 id="response-handling">Response handling</h4>

<hr/>
<pre class="highlight scala"><span class="n">halt</span><span class="o">(</span><span class="mi">404</span><span class="o">)</span>
<span class="n">halt</span><span class="o">(</span><span class="n">status</span> <span class="k">=</span> <span class="mi">400</span><span class="o">,</span> <span class="n">headers</span> <span class="k">=</span> <span class="nc">Map</span><span class="o">(</span><span class="s">"foo"</span> <span class="o">-&gt;</span> <span class="s">"bar"</span><span class="o">),</span> <span class="n">reason</span> <span class="k">=</span> <span class="s">"why"</span><span class="o">)</span>

<span class="n">redirect</span><span class="o">(</span><span class="s">"/top"</span><span class="o">)</span> <span class="c1">// 302
</span><span class="n">redirect301</span><span class="o">(</span><span class="s">"/new_url"</span><span class="o">)</span> <span class="c1">// 301
</span><span class="n">redirect302</span><span class="o">(</span><span class="s">"/somewhere"</span><span class="o">)</span> <span class="c1">// 302
</span><span class="n">redirect303</span><span class="o">(</span><span class="s">"/complete"</span><span class="o">)</span> <span class="c1">// 303
</span></pre>

<p><a href="http://www.scalatra.org/2.2/api/index.html#org.scalatra.ScalatraBase">/api/index.html#org.scalatra.ScalatraBase</a></p>

<p><a href="http://www.scalatra.org/2.2/api/index.html#org.scalatra.ActionResult">/index.html#org.scalatra.ActionResult</a></p>

<p><a href="https://github.com/skinny-framework/skinny-framework/blob/1.1.x/framework/src/main/scala/skinny/controller/feature/ExplicitRedirectFeature.scala">/framework/src/main/scala/skinny/controller/feature/ExplicitRedirectFeature.scala</a></p>

<p><a href="https://github.com/scalatra/scalatra/blob/2.2.x_2.10/core/src/main/scala/org/scalatra/ActionResult.scala">/core/src/main/scala/org/scalatra/ActionResult.scala</a></p>

<hr/>

<h4 id="csrf-protection">CSRF Protection</h4>

<hr/>

<p>Notice: Scalatra CSRF protection implementation uses servlet sessions by default. Be aware of sticky session mode.</p>

<p>Define <code>protectFromForgery</code> in controller/RootController.scala:</p>
<pre class="highlight scala"><span class="k">class</span> <span class="nc">RootController</span> <span class="k">extends</span> <span class="nc">ApplicationController</span> <span class="o">{</span>
  <span class="n">protectFromForgery</span><span class="o">()</span>

<span class="o">}</span>
</pre>

<p>Use <code>Skinny.csrfMetaTags</code> in /WEB-INF/layouts/default.jade:</p>
<pre class="highlight plaintext">-@val body: String
-@val s: skinny.Skinny
!!! 5
%html(lang="en")
  %head
    %meta(charset="utf-8")
    != s.csrfMetaTags
  %body
    =unescape(body)
    %script(type="text/javascript" src={uri("/assets/js/skinny.js")})
</pre>

<hr/>

<h4 id="check-execution-time">Check execution time</h4>

<hr/>
<pre class="highlight scala"><span class="k">val</span> <span class="n">result</span> <span class="k">=</span> <span class="n">warnElapsedTime</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
  <span class="nc">Thread</span><span class="o">.</span><span class="n">sleep</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
<span class="o">}</span>
<span class="c1">// will output "[SLOW EXECUTION DETECTED] Elapsed time: 10 millis"
</span></pre>

<p>In controllers, you can add request info:</p>
<pre class="highlight scala"><span class="k">val</span> <span class="n">result</span> <span class="k">=</span> <span class="n">warnElapsedTimeWithRequest</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
  <span class="nc">Thread</span><span class="o">.</span><span class="n">sleep</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
<span class="o">}</span>
</pre>

<hr/>

<h4 id="read-your-own-configuration-values">Read your own configuration values</h4>

<hr/>
<pre class="highlight plaintext">development {
  defaultLabel="foo"
  timeout {
    connect=1000
    read=3000
  }
  memcached=["server1:11211", "server2:11211"]
}
</pre>

<p>Read the server names like this:</p>
<pre class="highlight scala"><span class="k">val</span> <span class="n">label</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="nc">SkinnyConfig</span><span class="o">.</span><span class="n">stringConfigValue</span><span class="o">(</span><span class="s">"defaultLabel"</span><span class="o">)</span>
<span class="k">val</span> <span class="n">connectTimeout</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">SkinnyConfig</span><span class="o">.</span><span class="n">intConfigValue</span><span class="o">(</span><span class="s">"timeout.connect"</span><span class="o">)</span>
<span class="k">val</span> <span class="n">memcachedServers</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Seq</span><span class="o">[</span><span class="kt">String</span><span class="o">]]</span> <span class="k">=</span> <span class="nc">SkinnyConfig</span><span class="o">.</span><span class="n">stringSeqConfigValue</span><span class="o">(</span><span class="s">"memcached"</span><span class="o">)</span>
</pre>

            <hr/>
            <div class="alert alert-info small"> 
              If you find a typo or mistake in this page, please report or fix it. <a href="/contribution.html">How?</a>
            </div> 

<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=658247244206928";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<div class="fb-like" data-href="http://skinny-framework.org/" data-layout="standard" data-action="recommend" data-show-faces="true" data-share="true"></div>

<a href="https://twitter.com/skinnyframework" class="twitter-follow-button" data-show-count="false">Follow @skinnyframework</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

<a href="https://twitter.com/share" class="twitter-share-button" data-url="http://skinny-framework.org/" data-text="#Scala on #Rails" data-via="skinnyframework">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
</a>

          </div>
        </div>
      </div>
    </div>
    <script type="text/javascript" src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
  </body>
</html>

