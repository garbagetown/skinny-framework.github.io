<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <!-- Use title if it's in the page YAML frontmatter -->
    <title>ORM - Skinny Framework</title>
    <script type="text/javascript" src="//codeorigin.jquery.com/jquery-1.11.0.min.js"></script>
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css"/>
    <link href="/stylesheets/all.css" rel="stylesheet" type="text/css" />
    <script src="/javascripts/all.js" type="text/javascript"></script>
  </head>
  <body>
    <div class="container">
    <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
<a href="https://github.com/skinny-framework/skinny-framework"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"></a>
      <div class="container">
        <div class="navbar-header">
          <a class="navbar-brand" href="/"><b>Skinny Framework</b> <span class="subtitle">- Rapid Development in Scala -</span></a>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li class="dropdown">
              <a href="/documentation" class="dropdown-toggle" data-toggle="dropdown">Documentation&nbsp;<b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a href="/documentation/getting-started.html">Getting Started</a></li>
                <li><a href="/documentation/scaffolding.html">Scaffolding</a></li>
                <li><a href="/documentation/controller-and-routes.html">Controller & Routes</a></li>
                <li><a href="/documentation/validator.html">Validator</a></li>
                <li><a href="/documentation/view-templates.html">View Templates</a></li>
                <li><a href="/documentation/assets.html">Assets Support</a></li>
                <li><a href="/documentation/mail.html">Mail</a></li>
                <li><a href="/documentation/worker_jobs.html">Worker Jobs</a></li>
                <li><a href="/documentation/i18n.html">i18n</a></li>
                <li><a href="/documentation/orm.html">O/R Mapper</a></li>
                <li><a href="/documentation/factory-girl.html">FactoryGirl</a></li>
                <li><a href="/documentation/db-migration.html">DB Migration</a></li>
                <li><a href="/documentation/json.html">Working with JSON</a></li>
                <li><a href="/documentation/tasks.html">Tasks</a></li>
                <li><a href="/documentation/testing.html">Testing</a></li>
                <li><a href="/documentation/packaging.html">Packaging</a></li>
                <li><a href="/documentation/community.html">Community</a></li>
                <li><a href="/contribution.html">Contribution</a></li>
              </ul>
            </li>
            <li><a href="https://github.com/skinny-framework/skinny-framework">Source Code on GitHub</a></li>
            <li><a href="https://groups.google.com/forum/#!forum/skinny-framework">Users ML <small>(Google Group)</small></a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>
    <hr/>
        <div class="col-sm-12">
          <div class="content">
            <h2 id="orm">ORM</h2>

<hr/>

<h3 id="skinny-orm">Skinny-ORM</h3>

<hr/>

<p>Skinny provides you with Skinny-ORM as the default O/R mapper, which is built with <a href="https://github.com/scalikejdbc/scalikejdbc">ScalikeJDBC</a>. This is a portable library, so you can also use it with Play2, pure Scalatra, Lift and any other frameworks.</p>

<p><img alt="Logo" src="/images/scalikejdbc.png" /></p>

<p>A key feature of Skinny-ORM is that it avoids N+1 queries because associations are resolved by join queries. </p>

<p><code>#belongsTo</code>, <code>#hasOne</code> and <code>#hasMany(Through)</code> associations are converted into join queries, so you don&rsquo;t need to worry about performance problems caused by N+1 queries. </p>

<p>Furthermore, the <code>#byDefault</code> option allows you to resolve assocations anytime. If you don&rsquo;t always need some association, miss the <code>#byDefault</code> and just use <code>#joins</code> method such as <code>Team.joins(Team.members).findById(123)</code> on demand.</p>

<p>On the other hand, it&rsquo;s impossible to resolve all the nested attributes&#39; relationships by a single join query. If you need to resolve nested relationships, you can retrieve them with eager loading by using <code>#includes</code> method.</p>

<hr/>

<h4 id="the-best-way-to-learn">The Best way to learn</h4>

<p>The best way to learn is by reading the following examamples. </p>

<p>Table definitions: <a href="https://github.com/skinny-framework/skinny-framework/blob/develop/orm/src/test/scala/skinny/orm/CreateTables.scala">https://github.com/skinny-framework/skinny-framework/blob/develop/orm/src/test/scala/skinny/orm/CreateTables.scala</a></p>

<p>Model examples: <a href="https://github.com/skinny-framework/skinny-framework/blob/develop/orm/src/test/scala/skinny/orm/models.scala">https://github.com/skinny-framework/skinny-framework/blob/develop/orm/src/test/scala/skinny/orm/models.scala</a></p>

<p>Usage: <a href="https://github.com/skinny-framework/skinny-framework/blob/develop/orm/src/test/scala/skinny/orm/SkinnyORMSpec.scala">https://github.com/skinny-framework/skinny-framework/blob/develop/orm/src/test/scala/skinny/orm/SkinnyORMSpec.scala</a></p>

<p>If you have any questions or feedback, feel free to ask the Skinny team or users in the mailing list.</p>

<p><a href="https://groups.google.com/forum/#!forum/skinny-framework">https://groups.google.com/forum/#!forum/skinny-framework</a></p>

<hr/>

<h3 id="your-first-mapper">Your First Mapper</h3>

<hr/>

<h4 id="easy-to-use-and-powerful">Easy to use and powerful</h4>

<p>Skinny-ORM is very powerful, so you don&rsquo;t need to write much code. Your first model class and companion are here.</p>
<pre class="highlight scala"><span class="k">import</span> <span class="nn">skinny.orm._</span>
<span class="k">import</span> <span class="nn">scalikejdbc._</span><span class="o">,</span> <span class="nc">SQLInterpolation</span><span class="o">.</span><span class="k">_</span>
<span class="k">import</span> <span class="nn">org.joda.time._</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">Member</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">Long</span><span class="o">,</span> <span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">createdAt</span><span class="k">:</span> <span class="kt">DateTime</span><span class="o">)</span>

<span class="k">object</span> <span class="nc">Member</span> <span class="k">extends</span> <span class="nc">SkinnyCRUDMapper</span><span class="o">[</span><span class="kt">Member</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">defaultAlias</span> <span class="k">=</span> <span class="n">createAlias</span><span class="o">(</span><span class="s">"m"</span><span class="o">)</span>

  <span class="k">override</span> <span class="k">def</span> <span class="n">extract</span><span class="o">(</span><span class="n">rs</span><span class="k">:</span> <span class="kt">WrappedResultSet</span><span class="o">,</span> <span class="n">n</span><span class="k">:</span> <span class="kt">ResultName</span><span class="o">[</span><span class="kt">Member</span><span class="o">])</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Member</span><span class="o">(</span>
    <span class="n">id</span> <span class="k">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">long</span><span class="o">(</span><span class="n">n</span><span class="o">.</span><span class="n">id</span><span class="o">),</span>
    <span class="n">name</span> <span class="k">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">string</span><span class="o">(</span><span class="n">n</span><span class="o">.</span><span class="n">name</span><span class="o">),</span>
    <span class="n">createdAt</span> <span class="k">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">dateTime</span><span class="o">(</span><span class="n">n</span><span class="o">.</span><span class="n">createdAt</span><span class="o">)</span>
  <span class="o">)</span>
<span class="o">}</span>
</pre>

<p>That&rsquo;s all! Now you can use the following APIs.</p>
<pre class="highlight scala"><span class="k">val</span> <span class="n">m</span> <span class="k">=</span> <span class="nc">Member</span><span class="o">.</span><span class="n">defaultAlias</span>

<span class="c1">// ------------
// find by primary key
</span><span class="k">val</span> <span class="n">member</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Member</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Member</span><span class="o">.</span><span class="n">findById</span><span class="o">(</span><span class="mi">123</span><span class="o">)</span>

<span class="k">val</span> <span class="n">member</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Member</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Member</span><span class="o">.</span><span class="n">where</span><span class="o">(</span><span class="ss">'id </span><span class="o">-&gt;</span> <span class="mi">123</span><span class="o">).</span><span class="n">apply</span><span class="o">().</span><span class="n">headOption</span>

<span class="c1">// ------------
// find many
</span><span class="k">val</span> <span class="n">members</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Member</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Member</span><span class="o">.</span><span class="n">findAll</span><span class="o">()</span>

<span class="c1">// ------------
// in clause
</span><span class="k">val</span> <span class="n">members</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Member</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Member</span><span class="o">.</span><span class="n">findAllBy</span><span class="o">(</span><span class="n">sqls</span><span class="o">.</span><span class="n">in</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="n">id</span><span class="o">,</span> <span class="nc">Seq</span><span class="o">(</span><span class="mi">123</span><span class="o">,</span> <span class="mi">234</span><span class="o">,</span> <span class="mi">345</span><span class="o">)))</span>

<span class="k">val</span> <span class="n">members</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Member</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Member</span><span class="o">.</span><span class="n">where</span><span class="o">(</span><span class="ss">'id </span><span class="o">-&gt;</span> <span class="nc">Seq</span><span class="o">(</span><span class="mi">123</span><span class="o">,</span> <span class="mi">234</span><span class="o">,</span> <span class="mi">345</span><span class="o">)).</span><span class="n">apply</span><span class="o">()</span>

<span class="c1">// will return 345, 234, 123 in order
</span><span class="k">val</span> <span class="n">m</span> <span class="k">=</span> <span class="nc">Member</span><span class="o">.</span><span class="n">defaultAlias</span>
<span class="k">val</span> <span class="n">members</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Member</span><span class="o">]</span> <span class="k">=</span> 
  <span class="nc">Member</span><span class="o">.</span><span class="n">where</span><span class="o">(</span><span class="ss">'id </span><span class="o">-&gt;</span> <span class="nc">Seq</span><span class="o">(</span><span class="mi">123</span><span class="o">,</span> <span class="mi">234</span><span class="o">,</span> <span class="mi">345</span><span class="o">))</span>
    <span class="o">.</span><span class="n">orderBy</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">desc</span><span class="o">).</span><span class="n">offset</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="n">limit</span><span class="o">(</span><span class="mi">5</span><span class="o">)</span>
    <span class="o">.</span><span class="n">apply</span><span class="o">()</span>

<span class="c1">// ------------
// find by condition
</span>
<span class="k">val</span> <span class="n">members</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Member</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Member</span><span class="o">.</span><span class="n">findAllBy</span><span class="o">(</span>
  <span class="n">sqls</span><span class="o">.</span><span class="n">eq</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="n">groupName</span><span class="o">,</span> <span class="s">"scalajp"</span><span class="o">).</span><span class="n">and</span><span class="o">.</span><span class="n">eq</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="n">delete</span><span class="o">,</span> <span class="kc">false</span><span class="o">))</span>

<span class="k">val</span> <span class="n">members</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Member</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Member</span><span class="o">.</span><span class="n">where</span><span class="o">(</span>
  <span class="ss">'groupName </span><span class="o">-&gt;</span> <span class="s">"scalajp"</span><span class="o">,</span> <span class="ss">'deleted </span><span class="o">-&gt;</span> <span class="kc">false</span><span class="o">).</span><span class="n">apply</span><span class="o">()</span>

<span class="c1">// use Pagination instead. Easier to understand than limit/offset
</span><span class="k">val</span> <span class="n">members</span> <span class="k">=</span> <span class="nc">Member</span><span class="o">.</span><span class="n">where</span><span class="o">(</span><span class="n">sqls</span><span class="o">.</span><span class="n">eq</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="n">groupId</span><span class="o">,</span> <span class="mi">123</span><span class="o">))</span>
  <span class="o">.</span><span class="n">paginate</span><span class="o">(</span><span class="nc">Pagination</span><span class="o">.</span><span class="n">page</span><span class="o">(</span><span class="mi">1</span><span class="o">).</span><span class="n">per</span><span class="o">(</span><span class="mi">20</span><span class="o">))</span>
  <span class="o">.</span><span class="n">orderBy</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">desc</span><span class="o">).</span><span class="n">apply</span><span class="o">()</span>

<span class="c1">// ------------
// count
</span>
<span class="nc">Order</span><span class="o">.</span><span class="n">count</span><span class="o">()</span>
<span class="nc">Order</span><span class="o">.</span><span class="n">countBy</span><span class="o">(</span><span class="n">sqls</span><span class="o">.</span><span class="n">isNull</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="n">deletedAt</span><span class="o">).</span><span class="n">and</span><span class="o">.</span><span class="n">eq</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="n">shopId</span><span class="o">,</span> <span class="mi">123</span><span class="o">))</span>

<span class="nc">Order</span><span class="o">.</span><span class="n">where</span><span class="o">(</span><span class="ss">'deletedAt </span><span class="o">-&gt;</span> <span class="nc">None</span><span class="o">,</span> <span class="ss">'shopId </span><span class="o">-&gt;</span> <span class="mi">123</span><span class="o">).</span><span class="n">count</span><span class="o">()</span>
<span class="nc">Order</span><span class="o">.</span><span class="n">where</span><span class="o">(</span><span class="n">sqls</span><span class="o">.</span><span class="n">eq</span><span class="o">(</span><span class="n">o</span><span class="o">.</span><span class="n">cancelled</span><span class="o">,</span> <span class="kc">false</span><span class="o">)).</span><span class="n">distinctCount</span><span class="o">(</span><span class="ss">'customerId)</span>

<span class="c1">// ------------
// calcuations
// min, max, average and sum
</span>
<span class="nc">Order</span><span class="o">.</span><span class="n">sum</span><span class="o">(</span><span class="ss">'amount)</span>

<span class="nc">Product</span><span class="o">.</span><span class="n">min</span><span class="o">(</span><span class="ss">'price)</span>
<span class="nc">Product</span><span class="o">.</span><span class="n">where</span><span class="o">(</span><span class="n">sqls</span><span class="o">.</span><span class="n">ge</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="n">createdAt</span><span class="o">,</span> <span class="n">startDate</span><span class="o">)).</span><span class="n">max</span><span class="o">(</span><span class="ss">'price)</span>
<span class="nc">Product</span><span class="o">.</span><span class="n">average</span><span class="o">(</span><span class="ss">'price)</span>

<span class="nc">Product</span><span class="o">.</span><span class="n">calculate</span><span class="o">(</span><span class="n">sqls</span><span class="s">"original_func(${p.userId})"</span><span class="o">)</span>

<span class="c1">// ------------
// create with strong parameters
</span>
<span class="k">val</span> <span class="n">params</span> <span class="k">=</span> <span class="nc">Map</span><span class="o">(</span><span class="s">"name"</span> <span class="o">-&gt;</span> <span class="s">"Bob"</span><span class="o">)</span>
<span class="k">val</span> <span class="n">id</span> <span class="k">=</span> <span class="nc">Member</span><span class="o">.</span><span class="n">createWithPermittedAttributes</span><span class="o">(</span><span class="n">params</span><span class="o">.</span><span class="n">permit</span><span class="o">(</span><span class="s">"name"</span> <span class="o">-&gt;</span> <span class="nc">ParamType</span><span class="o">.</span><span class="nc">String</span><span class="o">))</span>

<span class="c1">// ------------
// create with unsafe parameters
</span>
<span class="k">val</span> <span class="n">m</span> <span class="k">=</span> <span class="nc">Member</span><span class="o">.</span><span class="n">defaultAlias</span>
<span class="k">val</span> <span class="n">id</span> <span class="k">=</span> <span class="nc">Member</span><span class="o">.</span><span class="n">createWithNamedValues</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="n">name</span> <span class="o">-&gt;</span> <span class="s">"Alice"</span><span class="o">)</span>

<span class="nc">Member</span><span class="o">.</span><span class="n">createWithAttributes</span><span class="o">(</span>
  <span class="ss">'id </span><span class="o">-&gt;</span> <span class="mi">123</span><span class="o">,</span>
  <span class="ss">'name </span><span class="o">-&gt;</span> <span class="s">"Chris"</span><span class="o">,</span>
  <span class="ss">'createdAt </span><span class="o">-&gt;</span> <span class="nc">DateTime</span><span class="o">.</span><span class="n">now</span>
<span class="o">)</span>

<span class="c1">// ------------
// update with strong parameters
</span>
<span class="nc">Member</span><span class="o">.</span><span class="n">updateById</span><span class="o">(</span><span class="mi">123</span><span class="o">).</span><span class="n">withPermittedAttributes</span><span class="o">(</span><span class="n">params</span><span class="o">.</span><span class="n">permit</span><span class="o">(</span><span class="s">"name"</span> <span class="o">-&gt;</span> <span class="nc">ParamType</span><span class="o">.</span><span class="nc">String</span><span class="o">))</span>

<span class="c1">// ------------
// update with unsafe parameters
</span>
<span class="nc">Member</span><span class="o">.</span><span class="n">updateById</span><span class="o">(</span><span class="mi">123</span><span class="o">).</span><span class="n">withAttributes</span><span class="o">(</span><span class="ss">'name </span><span class="o">-&gt;</span> <span class="s">"Alice"</span><span class="o">)</span>

<span class="c1">// update by condition
</span>
<span class="nc">Member</span><span class="o">.</span><span class="n">updateBy</span><span class="o">(</span><span class="n">sqls</span><span class="o">.</span><span class="n">eq</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="n">groupId</span><span class="o">,</span> <span class="mi">123</span><span class="o">)).</span><span class="n">withAttribtues</span><span class="o">(</span><span class="ss">'groupId </span><span class="o">-&gt;</span> <span class="mi">234</span><span class="o">)</span>

<span class="c1">// ------------
// delete
</span>
<span class="nc">Member</span><span class="o">.</span><span class="n">deleteById</span><span class="o">(</span><span class="mi">234</span><span class="o">)</span>
<span class="nc">Member</span><span class="o">.</span><span class="n">deleteBy</span><span class="o">(</span><span class="n">sqls</span><span class="o">.</span><span class="n">eq</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="n">groupId</span><span class="o">,</span> <span class="mi">123</span><span class="o">))</span>
</pre>

<p>Source code: 
<a href="https://github.com/skinny-framework/skinny-framework/blob/master/orm/src/main/scala/skinny/orm/feature/CRUDFeature.scala">https://github.com/skinny-framework/skinny-framework/blob/master/orm/src/main/scala/skinny/orm/feature/CRUDFeature.scala</a></p>

<hr/>

<h3 id="associations">Associations</h3>

<hr/>

<p>If you need to join other tables, just add <code>belongsTo</code>, <code>hasOne</code> or <code>hasMany(Through)</code> to the companion. </p>

<p>Examples: 
<a href="https://github.com/skinny-framework/skinny-framework/blob/develop/orm/src/test/scala/skinny/orm/models.scala">https://github.com/skinny-framework/skinny-framework/blob/develop/orm/src/test/scala/skinny/orm/models.scala</a></p>

<p>Be aware of Skinny ORM&rsquo;s concept that basically joins tables to resolve associations to reduce N+1 queries. We recommend enabling query logging for development.</p>

<p><a href="http://scalikejdbc.org/documentation/query-inspector.html">http://scalikejdbc.org/documentation/query-inspector.html</a></p>

<p>Typically defining associations are fundamentally not so simple, so you might be confused when specifying these definitions. Understanding how ScalikeJDBC&rsquo;s join queries and One-to-X APIs work may be useful.</p>

<p><a href="http://scalikejdbc.org/documentation/one-to-x.html">http://scalikejdbc.org/documentation/one-to-x.html</a></p>

<hr/>

<h4 id="belongsto">BelongsTo</h4>

<p>Same as ActiveRecord&rsquo;s <code>belongs_to</code> assocation:</p>

<p><a href="http://guides.rubyonrails.org/association_basics.html#the-belongs-to-association">http://guides.rubyonrails.org/association_basics.html#the-belongs-to-association</a></p>

<p>We need to specify some types, so definitions are not as simple as ActiveRecord, but it&rsquo;s easy to understand and simple enough.</p>
<pre class="highlight scala"><span class="k">case</span> <span class="k">class</span> <span class="nc">Company</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">Long</span><span class="o">,</span> <span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span>
<span class="k">class</span> <span class="nc">Member</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">Long</span><span class="o">,</span> <span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
  <span class="n">mentorId</span><span class="k">:</span> <span class="kt">Long</span><span class="o">,</span> <span class="n">mentor</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Member</span><span class="o">]</span> <span class="k">=</span> <span class="nc">None</span><span class="o">,</span>
  <span class="n">companyId</span><span class="k">:</span> <span class="kt">Long</span><span class="o">,</span> <span class="n">company</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Company</span><span class="o">]</span> <span class="k">=</span> <span class="nc">None</span><span class="o">)</span>

<span class="k">object</span> <span class="nc">Member</span> <span class="k">extends</span> <span class="nc">SkinnyCRUDMapper</span><span class="o">[</span><span class="kt">Member</span><span class="o">]</span> <span class="o">{</span>
  <span class="c1">// basic settings ...
</span>
  <span class="c1">// If byDefault is called, this join condition is enabled by default
</span>  <span class="n">belongsTo</span><span class="o">[</span><span class="kt">Company</span><span class="o">](</span><span class="nc">Company</span><span class="o">,</span> <span class="o">(</span><span class="n">m</span><span class="o">,</span> <span class="n">c</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">m</span><span class="o">.</span><span class="n">copy</span><span class="o">(</span><span class="n">company</span> <span class="k">=</span> <span class="n">c</span><span class="o">)).</span><span class="n">byDefault</span>

  <span class="c1">// or more explanatory
</span>  <span class="n">belongsTo</span><span class="o">[</span><span class="kt">Company</span><span class="o">](</span>
    <span class="c1">// entity mapper on the right side
</span>    <span class="c1">// in this case, default alias will be used in join query
</span>    <span class="n">right</span> <span class="k">=</span> <span class="nc">Company</span><span class="o">,</span> 
    <span class="c1">// function to merge association to main entity
</span>    <span class="n">merge</span> <span class="k">=</span> <span class="o">(</span><span class="n">member</span><span class="o">,</span> <span class="n">company</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">member</span><span class="o">.</span><span class="n">copy</span><span class="o">(</span><span class="n">company</span> <span class="k">=</span> <span class="n">company</span><span class="o">)</span>
  <span class="o">).</span><span class="n">byDefault</span>

  <span class="c1">// when you cannot use defaultAlias, use this instead
</span>  <span class="k">val</span> <span class="n">mentorAlais</span> <span class="k">=</span> <span class="n">createAlias</span><span class="o">(</span><span class="s">"mentor"</span><span class="o">)</span>
  <span class="k">val</span> <span class="n">mentor</span> <span class="k">=</span> <span class="n">belongsToWithAlias</span><span class="o">(</span>
    <span class="c1">// in this case, "mentor" alias will be used in join query
</span>    <span class="n">right</span> <span class="k">=</span> <span class="nc">Member</span> <span class="o">-&gt;</span> <span class="n">mentorAlias</span><span class="o">,</span>
    <span class="n">merge</span> <span class="k">=</span> <span class="o">(</span><span class="n">member</span><span class="o">,</span> <span class="n">mentor</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">member</span><span class="o">.</span><span class="n">copy</span><span class="o">(</span><span class="n">mentor</span> <span class="k">=</span> <span class="n">mentor</span><span class="o">))</span>
    <span class="c1">// mentor will be resolved only when calling #joins 
</span>    <span class="cm">/*.byDefault */</span> 
<span class="o">}</span>

<span class="nc">Member</span><span class="o">.</span><span class="n">findById</span><span class="o">(</span><span class="mi">123</span><span class="o">)</span> <span class="c1">// without mentor
</span>
<span class="nc">Member</span><span class="o">.</span><span class="n">joins</span><span class="o">(</span><span class="nc">Member</span><span class="o">.</span><span class="n">mentor</span><span class="o">).</span><span class="n">findById</span><span class="o">(</span><span class="mi">123</span><span class="o">)</span> <span class="c1">// with mentor
</span></pre>

<p>In this case, following table is expected:</p>
<pre class="highlight sql"><span class="k">create</span> <span class="k">table</span> <span class="n">members</span> <span class="p">(</span>
  <span class="n">id</span> <span class="n">bigint</span> <span class="n">auto_increment</span> <span class="k">primary</span> <span class="k">key</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="n">company_id</span> <span class="n">bigint</span><span class="p">,</span>
  <span class="n">mentor_id</span> <span class="n">bigint</span>
<span class="p">);</span>
<span class="k">create</span> <span class="k">table</span> <span class="n">companies</span> <span class="p">(</span>
  <span class="n">id</span> <span class="n">bigint</span> <span class="n">auto_increment</span> <span class="k">primary</span> <span class="k">key</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="n">name</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span> <span class="k">not</span> <span class="k">null</span>
<span class="p">);</span>
</pre>

<p>Find more here: <a href="https://github.com/skinny-framework/skinny-framework/blob/develop/orm/src/main/scala/skinny/orm/feature/AssociationsFeature.scala">https://github.com/skinny-framework/skinny-framework/blob/develop/orm/src/main/scala/skinny/orm/feature/AssociationsFeature.scala</a></p>

<hr/>

<h4 id="hasone">HasOne</h4>

<p>Same as ActiveRecord&rsquo;s <code>has_one</code> assocation:</p>

<p><a href="http://guides.rubyonrails.org/association_basics.html#the-has-one-association">http://guides.rubyonrails.org/association_basics.html#the-has-one-association</a></p>

<p>We need to specify some types, so definitions are not as simple as ActiveRecord, but it&rsquo;s easy to understand and simple enough.</p>
<pre class="highlight scala"><span class="k">case</span> <span class="k">class</span> <span class="nc">Name</span><span class="o">(</span><span class="n">first</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">last</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">memberId</span><span class="k">:</span> <span class="kt">Long</span><span class="o">)</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Member</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">Long</span><span class="o">,</span> <span class="n">name</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Name</span><span class="o">]</span> <span class="k">=</span> <span class="nc">None</span><span class="o">)</span>

<span class="k">object</span> <span class="nc">Member</span> <span class="k">extends</span> <span class="nc">SkinnyCRUDMapper</span><span class="o">[</span><span class="kt">Member</span><span class="o">]</span> <span class="o">{</span>
  <span class="c1">// basic settings ...
</span>
  <span class="k">val</span> <span class="n">name</span> <span class="k">=</span> <span class="n">hasOne</span><span class="o">[</span><span class="kt">Name</span><span class="o">](</span>
    <span class="n">right</span> <span class="k">=</span> <span class="nc">Name</span><span class="o">,</span> 
    <span class="n">merge</span> <span class="k">=</span> <span class="o">(</span><span class="n">member</span><span class="o">,</span> <span class="n">name</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">member</span><span class="o">.</span><span class="n">copy</span><span class="o">(</span><span class="n">name</span> <span class="k">=</span> <span class="n">name</span><span class="o">)</span>
  <span class="o">).</span><span class="n">byDefault</span>
<span class="o">}</span>
</pre>

<p>In this case, following tables are expected:</p>
<pre class="highlight sql"><span class="k">create</span> <span class="k">table</span> <span class="n">members</span> <span class="p">(</span>
  <span class="n">id</span> <span class="n">bigint</span> <span class="n">auto_increment</span> <span class="k">primary</span> <span class="k">key</span> <span class="k">not</span> <span class="k">null</span>
<span class="p">);</span>
<span class="k">create</span> <span class="k">table</span> <span class="k">names</span> <span class="p">(</span>
  <span class="n">member_id</span> <span class="n">bigint</span> <span class="k">primary</span> <span class="k">key</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="k">first</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="k">last</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span> <span class="k">not</span> <span class="k">null</span>
<span class="p">);</span>
</pre>

<hr/>

<h4 id="hasmany">HasMany</h4>

<p>Same as ActiveRecord&rsquo;s <code>has_many</code> assocation:</p>

<p><a href="http://guides.rubyonrails.org/association_basics.html#the-has-many-association">http://guides.rubyonrails.org/association_basics.html#the-has-many-association</a></p>

<p>We need to specify some types, so definitions are not as simple as ActiveRecord, but it&rsquo;s easy to understand and simple enough.</p>
<pre class="highlight scala"><span class="k">case</span> <span class="k">class</span> <span class="nc">Company</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">Long</span><span class="o">,</span> <span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">members</span><span class="k">:</span> <span class="kt">Seq</span><span class="o">[</span><span class="kt">Member</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Nil</span><span class="o">)</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Member</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">Long</span><span class="o">,</span> 
  <span class="n">companyId</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Long</span><span class="o">]</span> <span class="k">=</span> <span class="nc">None</span><span class="o">,</span> <span class="n">company</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Company</span><span class="o">]</span> <span class="k">=</span> <span class="nc">None</span><span class="o">,</span>
  <span class="n">skills</span><span class="k">:</span> <span class="kt">Seq</span><span class="o">[</span><span class="kt">Skill</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Nil</span>
<span class="o">)</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Skill</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">Long</span><span class="o">,</span> <span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span>

<span class="c1">// -----------------------
// hasMany example
</span><span class="k">object</span> <span class="nc">Company</span> <span class="k">extends</span> <span class="nc">SkinnyCRUDMapper</span><span class="o">[</span><span class="kt">Company</span><span class="o">]</span> <span class="o">{</span>
  <span class="c1">// basic settings ...
</span>
  <span class="k">val</span> <span class="n">membersRef</span> <span class="k">=</span> <span class="n">hasMany</span><span class="o">[</span><span class="kt">Member</span><span class="o">](</span>
    <span class="c1">// association's SkinnyMapper and alias
</span>    <span class="n">many</span> <span class="k">=</span> <span class="nc">Member</span> <span class="o">-&gt;</span> <span class="nc">Member</span><span class="o">.</span><span class="n">membersAlias</span><span class="o">,</span>
    <span class="c1">// defines join condition by using aliases
</span>    <span class="n">on</span> <span class="k">=</span> <span class="o">(</span><span class="n">c</span><span class="o">,</span> <span class="n">m</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">sqls</span><span class="o">.</span><span class="n">eq</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="o">,</span> <span class="n">m</span><span class="o">.</span><span class="n">companyId</span><span class="o">),</span>
    <span class="c1">// function to merge associations to main entity
</span>    <span class="n">merge</span> <span class="k">=</span> <span class="o">(</span><span class="n">company</span><span class="o">,</span> <span class="n">members</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">company</span><span class="o">.</span><span class="n">copy</span><span class="o">(</span><span class="n">members</span> <span class="k">=</span> <span class="n">members</span><span class="o">)</span>
  <span class="o">)</span>
<span class="o">}</span>
<span class="nc">Company</span><span class="o">.</span><span class="n">joins</span><span class="o">(</span><span class="nc">Company</span><span class="o">.</span><span class="n">membersRef</span><span class="o">).</span><span class="n">findById</span><span class="o">(</span><span class="mi">123</span><span class="o">)</span> <span class="c1">// with members
</span>
<span class="c1">// -----------------------
// hasManyThrough example
</span>
<span class="c1">// join table definition
</span><span class="k">case</span> <span class="k">class</span> <span class="nc">MemberSkill</span><span class="o">(</span><span class="n">memberId</span><span class="k">:</span> <span class="kt">Long</span><span class="o">,</span> <span class="n">skillId</span><span class="k">:</span> <span class="kt">Long</span><span class="o">)</span>
<span class="k">object</span> <span class="nc">MemberSkill</span> <span class="k">extends</span> <span class="nc">SkinnyJoinTable</span><span class="o">[</span><span class="kt">MemberSkill</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">override</span> <span class="k">val</span> <span class="n">tableName</span> <span class="k">=</span> <span class="s">"members_skills"</span>
  <span class="k">override</span> <span class="k">val</span> <span class="n">defaultAlias</span> <span class="k">=</span> <span class="n">createAlias</span><span class="o">(</span><span class="s">"ms"</span><span class="o">)</span>
<span class="o">}</span>
<span class="c1">// hasManyThrough
</span><span class="k">object</span> <span class="nc">Member</span> <span class="k">extends</span> <span class="nc">SkinnyCRUDMapper</span><span class="o">[</span><span class="kt">Member</span><span class="o">]</span> <span class="o">{</span>
  <span class="c1">// basic settings ...
</span>
  <span class="k">val</span> <span class="n">skillsRef</span> <span class="k">=</span> <span class="n">hasManyThrough</span><span class="o">[</span><span class="kt">Skill</span><span class="o">](</span>
    <span class="n">through</span> <span class="k">=</span> <span class="nc">MemberSkill</span><span class="o">,</span> 
    <span class="n">many</span> <span class="k">=</span> <span class="nc">Skill</span><span class="o">,</span> 
    <span class="n">merge</span> <span class="k">=</span> <span class="o">(</span><span class="n">member</span><span class="o">,</span> <span class="n">skills</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">member</span><span class="o">.</span><span class="n">copy</span><span class="o">(</span><span class="n">skills</span> <span class="k">=</span> <span class="n">skills</span><span class="o">)</span>
  <span class="o">)</span>
<span class="o">}</span>
<span class="nc">Member</span><span class="o">.</span><span class="n">joins</span><span class="o">(</span><span class="nc">Member</span><span class="o">.</span><span class="n">skillsRef</span><span class="o">).</span><span class="n">findById</span><span class="o">(</span><span class="mi">234</span><span class="o">)</span> <span class="c1">// with skills
</span></pre>

<p>In this case, following tables are expected:</p>
<pre class="highlight sql"><span class="k">create</span> <span class="k">table</span> <span class="n">companies</span> <span class="p">(</span>
  <span class="n">id</span> <span class="n">bigint</span> <span class="n">auto_increment</span> <span class="k">primary</span> <span class="k">key</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="n">name</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">not</span> <span class="k">null</span>
<span class="p">);</span>
<span class="k">create</span> <span class="k">table</span> <span class="n">members</span> <span class="p">(</span>
  <span class="n">id</span> <span class="n">bigint</span> <span class="n">auto_increment</span> <span class="k">primary</span> <span class="k">key</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="n">company_id</span> <span class="n">bigint</span>
<span class="p">);</span>
<span class="k">create</span> <span class="k">table</span> <span class="n">skills</span> <span class="p">(</span>
  <span class="n">id</span> <span class="n">bigint</span> <span class="n">auto_increment</span> <span class="k">primary</span> <span class="k">key</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="n">name</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">not</span> <span class="k">null</span>
<span class="p">);</span>
<span class="k">create</span> <span class="k">table</span> <span class="n">members_skills</span> <span class="p">(</span>
  <span class="n">member_id</span> <span class="n">bigint</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="n">skill_id</span> <span class="n">bigint</span> <span class="k">not</span> <span class="k">null</span>
<span class="p">);</span>
</pre>

<hr/>

<h4 id="what&#39;s-more">What&rsquo;s more</h4>

<p>You can find more examples here:</p>

<p>Table definitions:
<a href="https://github.com/skinny-framework/skinny-framework/blob/develop/orm/src/test/scala/skinny/orm/CreateTables.scala">https://github.com/skinny-framework/skinny-framework/blob/develop/orm/src/test/scala/skinny/orm/CreateTables.scala</a></p>

<p>Model examples:
<a href="https://github.com/skinny-framework/skinny-framework/blob/develop/orm/src/test/scala/skinny/orm/models.scala">https://github.com/skinny-framework/skinny-framework/blob/develop/orm/src/test/scala/skinny/orm/models.scala</a></p>

<p>Usage:
<a href="https://github.com/skinny-framework/skinny-framework/blob/develop/orm/src/test/scala/skinny/orm/SkinnyORMSpec.scala">https://github.com/skinny-framework/skinny-framework/blob/develop/orm/src/test/scala/skinny/orm/SkinnyORMSpec.scala</a></p>

<hr/>

<h4 id="entity-equality">Entity Equality</h4>

<p>Basically using case classes for entities is recommended. As you know, Scala (until 2.11) has 22 limitation, so you may need to use normal classes for entities to treat tables that have more than 22 columns.</p>

<p>In this case, entities should be defined like this (Skinny 0.9.21 or ScalikeJDBC 1.7.3 is required):</p>
<pre class="highlight scala"><span class="k">class</span> <span class="nc">LegacyData</span><span class="o">(</span><span class="k">val</span> <span class="n">id</span><span class="k">:</span> <span class="kt">Long</span><span class="o">,</span> <span class="k">val</span> <span class="n">c2</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="k">val</span> <span class="n">c3</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="o">...,</span> <span class="k">val</span> <span class="n">c23</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span>
  <span class="k">extends</span> <span class="n">scalikejdbc</span><span class="o">.</span><span class="nc">EntityEquality</span> <span class="o">{</span>
  <span class="c1">// override val entityIdentity = id
</span>  <span class="k">override</span> <span class="k">val</span> <span class="n">entityIdentity</span> <span class="k">=</span> <span class="n">s</span><span class="s">"$id $c2 $c3 ... $c23"</span>
<span class="o">}</span>

<span class="k">object</span> <span class="nc">LegacyData</span> <span class="k">extends</span> <span class="nc">SkinnyCRUDMapper</span><span class="o">[</span><span class="kt">LegacyData</span><span class="o">]</span> <span class="o">{</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre>

<p>If you don&rsquo;t implement like this, one-to-many relationships won&rsquo;t work as you expect.</p>

<p>See also the detailed explanation here: <a href="http://scalikejdbc.org/documentation/one-to-x.html">http://scalikejdbc.org/documentation/one-to-x.html</a></p>

<hr/>

<h3 id="eager-loading">Eager Loading</h3>

<hr/>

<p>When you enable eager loading using the <code>includes</code> API, you need to define both <code>belongsTo</code> and <code>includes</code>. </p>

<p>Note: eager loading of nested entities is not supported yet.</p>

<p>Indeed, it&rsquo;s not incredibly simple. But we believe that what it does is so clear that you can easily write the definition.</p>
<pre class="highlight scala"><span class="k">object</span> <span class="nc">Member</span> <span class="k">extends</span> <span class="nc">SkinnyCRUDMapper</span><span class="o">[</span><span class="kt">Member</span><span class="o">]</span> <span class="o">{</span>

  <span class="c1">// Unfortunately the combination of Scala macros and type-dynamic sometimes doesn't work as expected
</span>  <span class="c1">// when "val company" is defined in Scala 2.10.x.
</span>  <span class="c1">// If you suffer from this issue, use "val companyOpt" "companyRef" and so on instead.
</span>  <span class="k">val</span> <span class="n">companyOpt</span> <span class="k">=</span> <span class="o">{</span>
    <span class="c1">// normal belongsTo
</span>    <span class="n">belongsTo</span><span class="o">[</span><span class="kt">Company</span><span class="o">](</span>
      <span class="n">right</span> <span class="k">=</span> <span class="nc">Company</span><span class="o">,</span>
      <span class="n">merge</span> <span class="k">=</span> <span class="o">(</span><span class="n">member</span><span class="o">,</span> <span class="n">company</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">member</span><span class="o">.</span><span class="n">copy</span><span class="o">(</span><span class="n">company</span> <span class="k">=</span> <span class="n">company</span><span class="o">))</span>
    <span class="c1">// eager loading operation for this one-to-one relation
</span>    <span class="o">.</span><span class="n">includes</span><span class="o">[</span><span class="kt">Company</span><span class="o">](</span>
      <span class="n">merge</span> <span class="k">=</span> <span class="o">(</span><span class="n">members</span><span class="o">,</span> <span class="n">companies</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">members</span><span class="o">.</span><span class="n">map</span> <span class="o">{</span> <span class="n">m</span> <span class="k">=&gt;</span>
        <span class="n">companies</span><span class="o">.</span><span class="n">find</span><span class="o">(</span><span class="n">c</span> <span class="k">=&gt;</span> <span class="n">m</span><span class="o">.</span><span class="n">company</span><span class="o">.</span><span class="n">exists</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="o">))</span>
          <span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="n">c</span> <span class="k">=&gt;</span> <span class="n">m</span><span class="o">.</span><span class="n">copy</span><span class="o">(</span><span class="n">company</span> <span class="k">=</span> <span class="nc">Some</span><span class="o">(</span><span class="n">c</span><span class="o">)))</span>
          <span class="o">.</span><span class="n">getOrElse</span><span class="o">(</span><span class="n">m</span><span class="o">)</span>
      <span class="o">})</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="nc">Member</span><span class="o">.</span><span class="n">includes</span><span class="o">(</span><span class="n">companyOpt</span><span class="o">).</span><span class="n">findAll</span><span class="o">()</span>
</pre>

<p>Yet another example:</p>
<pre class="highlight scala"><span class="k">object</span> <span class="nc">Member</span> <span class="k">extends</span> <span class="nc">SkinnyCRUDMapper</span><span class="o">[</span><span class="kt">Member</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">skills</span> <span class="k">=</span>
    <span class="n">hasManyThrough</span><span class="o">[</span><span class="kt">Skill</span><span class="o">](</span>
      <span class="nc">MemberSkill</span><span class="o">,</span> <span class="nc">Skill</span><span class="o">,</span> <span class="o">(</span><span class="n">m</span><span class="o">,</span> <span class="n">skills</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">m</span><span class="o">.</span><span class="n">copy</span><span class="o">(</span><span class="n">skills</span> <span class="k">=</span> <span class="n">skills</span><span class="o">)</span>
    <span class="o">).</span><span class="n">includes</span><span class="o">[</span><span class="kt">Skill</span><span class="o">]((</span><span class="n">ms</span><span class="o">,</span> <span class="n">skills</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">ms</span><span class="o">.</span><span class="n">map</span> <span class="o">{</span> <span class="n">m</span> <span class="k">=&gt;</span>
      <span class="n">m</span><span class="o">.</span><span class="n">copy</span><span class="o">(</span><span class="n">kills</span> <span class="k">=</span> <span class="n">skills</span><span class="o">.</span><span class="n">filter</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">memberId</span><span class="o">.</span><span class="n">exists</span><span class="o">(</span><span class="k">_</span> <span class="o">==</span> <span class="n">m</span><span class="o">.</span><span class="n">id</span><span class="o">)))</span>
    <span class="o">})</span>
<span class="o">}</span>

<span class="nc">Member</span><span class="o">.</span><span class="n">includes</span><span class="o">(</span><span class="nc">Member</span><span class="o">.</span><span class="n">skills</span><span class="o">).</span><span class="n">findById</span><span class="o">(</span><span class="mi">123</span><span class="o">)</span> <span class="c1">// with skills
</span></pre>

<p>Note: when your entities have the same associations (e.g. Company has Employee, Country and Employee have Country), avoiding using the default alias for the associations is recommended because that may cause invalid join query generation when you use eager loading. We plan to provide more useful error messages for such cases in version 1.0.0.</p>

<p>Source code: 
<a href="https://github.com/skinny-framework/skinny-framework/blob/master/orm/src/main/scala/skinny/orm/feature/IncludesFeature.scala">https://github.com/skinny-framework/skinny-framework/blob/master/orm/src/main/scala/skinny/orm/feature/IncludesFeature.scala</a></p>

<hr/>

<h3 id="other-configurations">Other Configurations</h3>

<hr/>

<p>Skinny ORM provides the folllowing settings to overwrite.</p>
<pre class="highlight scala"><span class="k">object</span> <span class="nc">GroupMember</span> <span class="k">extends</span> <span class="nc">SkinnyCRUDMapper</span><span class="o">[</span><span class="kt">Member</span><span class="o">]</span> <span class="o">{</span>

  <span class="c1">// default: 'default
</span>  <span class="k">override</span> <span class="k">def</span> <span class="n">connectionPoolName</span> <span class="k">=</span> <span class="ss">'legacydb
</span>
  <span class="c1">// default: None 
</span>  <span class="k">override</span> <span class="k">def</span> <span class="n">schemaName</span> <span class="k">=</span> <span class="nc">Some</span><span class="o">(</span><span class="s">"public"</span><span class="o">)</span>

  <span class="c1">// Basically tableName is loaded from jdbc metadata and cached on the JVM
</span>  <span class="c1">// However, if the name of object/class which extends SkinnyMapper is not the camelCase of table name,
</span>  <span class="c1">// you need to override tableName by yourself.
</span>  <span class="k">override</span> <span class="k">def</span> <span class="n">tableName</span> <span class="k">=</span> <span class="s">"group_members"</span> <span class="c1">// default: group_member 
</span>
  <span class="c1">// Basically columnNames are loaded from jdbc metadata and cached on the JVM
</span>  <span class="k">override</span> <span class="k">def</span> <span class="n">columnNames</span> <span class="k">=</span> <span class="nc">Seq</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="s">"name"</span><span class="o">,</span> <span class="s">"birthday"</span><span class="o">,</span> <span class="s">"created_at"</span><span class="o">)</span>

  <span class="c1">// field name which represents the (single) primary key column
</span>  <span class="c1">// default: "id"
</span>  <span class="k">override</span> <span class="k">def</span> <span class="n">primaryKeyFieldName</span> <span class="k">=</span> <span class="s">"uid"</span> 

  <span class="c1">// with SkinnyCRUDMapper[GroupMember]
</span>  <span class="c1">// createWithAttributes will try to return generated id if true
</span>  <span class="c1">// default: true
</span>  <span class="k">override</span> <span class="k">def</span> <span class="n">useAutoIncrementPrimaryKey</span> <span class="k">=</span> <span class="kc">false</span>

  <span class="c1">// with SkinnyCRUDMapper[GroupMember]
</span>  <span class="c1">// default scope for update operations
</span>  <span class="c1">// default: None
</span>  <span class="k">override</span> <span class="k">def</span> <span class="n">defaultScopeForUpdateOperations</span> <span class="k">=</span> <span class="nc">Some</span><span class="o">(</span><span class="n">sqls</span><span class="o">.</span><span class="n">isNull</span><span class="o">(</span><span class="n">column</span><span class="o">.</span><span class="n">deletedAt</span><span class="o">))</span>

  <span class="c1">// with TimestampsFeature[GroupMember]
</span>  <span class="c1">// default: "createdAt"
</span>  <span class="k">override</span> <span class="k">def</span> <span class="n">createdAtFieldName</span> <span class="k">=</span> <span class="s">"createdTimestamp"</span>

  <span class="c1">// with TimestampsFeature[GroupMember]
</span>  <span class="c1">// default: "updatedAt"
</span>  <span class="k">override</span> <span class="k">def</span> <span class="n">updatedAtFieldName</span> <span class="k">=</span> <span class="s">"updatedTimestamp"</span>

  <span class="c1">// with OptimisticLockWithTimestampFeature[GroupMember] 
</span>  <span class="c1">// default: "lockTimestamp"
</span>  <span class="k">override</span> <span class="k">val</span> <span class="n">lockTimestampFieldName</span> <span class="k">=</span> <span class="s">"lockedAt"</span>

  <span class="c1">// with OptimisticLockWithVersionFeature[GroupMember]
</span>  <span class="c1">// default: "lockVersion"
</span>  <span class="k">override</span> <span class="k">val</span> <span class="n">lockVersionFieldName</span> <span class="k">=</span> <span class="s">"ver"</span>

  <span class="c1">// with SoftDeleteWithBooleanFeature[GroupMember]
</span>  <span class="c1">// default: "isDeleted"
</span>  <span class="k">override</span> <span class="k">val</span> <span class="n">isDeletedFieldName</span> <span class="k">=</span> <span class="s">"deleted"</span>

  <span class="c1">// with SoftDeleteWithTimestampFeature[GroupMember]
</span>  <span class="c1">// default: "deletedAt"
</span>  <span class="k">override</span> <span class="k">val</span> <span class="n">deletedAtFieldName</span> <span class="k">=</span> <span class="s">"deletedTimestamp"</span>

<span class="o">}</span>
</pre>

<hr/>

<h3 id="dynamic-table-name">Dynamic Table Name</h3>

<hr/>

<p><code>#withTableName</code> enables using another table name only for the current query.</p>
<pre class="highlight scala"><span class="k">object</span> <span class="nc">Order</span> <span class="k">extends</span> <span class="nc">SkinnyCRUDMapper</span><span class="o">[</span><span class="kt">Order</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">defaultAlias</span> <span class="k">=</span> <span class="n">createAlias</span><span class="o">(</span><span class="s">"o"</span><span class="o">)</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">tableName</span> <span class="k">=</span> <span class="s">"orders"</span>
<span class="o">}</span>

<span class="c1">// default: orders
</span><span class="nc">Order</span><span class="o">.</span><span class="n">count</span><span class="o">()</span>

<span class="c1">// other table: orders_2012
</span><span class="nc">Order</span><span class="o">.</span><span class="n">withTableName</span><span class="o">(</span><span class="s">"orders_2012"</span><span class="o">).</span><span class="n">count</span><span class="o">()</span>
</pre>

<p>Source code: 
<a href="https://github.com/skinny-framework/skinny-framework/blob/master/orm/src/main/scala/skinny/orm/feature/DynamicTableNameFeature.scala">https://github.com/skinny-framework/skinny-framework/blob/master/orm/src/main/scala/skinny/orm/feature/DynamicTableNameFeature.scala</a></p>

<hr/>

<h3 id="adding-methods">Adding Methods</h3>

<hr/>

<p>If you need to add methods, just write methods that use <code>#findBy</code>, <code>#countBy</code> or ScalikeJDBC&rsquo;s APIs directly.</p>
<pre class="highlight scala"><span class="k">object</span> <span class="nc">Member</span> <span class="k">extends</span> <span class="nc">SkinnyCRUDMapper</span><span class="o">[</span><span class="kt">Member</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">private</span><span class="o">[</span><span class="kt">this</span><span class="o">]</span> <span class="k">val</span> <span class="n">m</span> <span class="k">=</span> <span class="n">defaultAlias</span>

  <span class="k">def</span> <span class="n">findAllByGroupId</span><span class="o">(</span><span class="n">groupId</span><span class="k">:</span> <span class="kt">Long</span><span class="o">)(</span><span class="k">implicit</span> <span class="n">s</span><span class="k">:</span> <span class="kt">DBSession</span> <span class="o">=</span> <span class="n">autoSession</span><span class="o">)</span><span class="k">:</span> <span class="kt">Seq</span><span class="o">[</span><span class="kt">Member</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
    <span class="n">findAllBy</span><span class="o">(</span><span class="n">sqls</span><span class="o">.</span><span class="n">eq</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="n">groupId</span><span class="o">,</span> <span class="n">groupId</span><span class="o">))</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre>

<p>If you&rsquo;re using Skinny-ORM with Skinny Framework,
<a href="https://github.com/skinny-framework/skinny-framework/blob/master/orm/src/main/scala/skinny/orm/servlet/TxPerRequestFilter.scala">skinny.orm.servlet.TxPerRequestFilter</a> simplifies your applciations.</p>
<pre class="highlight scala"><span class="c1">// src/main/scala/ScalatraBootstrap.scala
</span><span class="k">class</span> <span class="nc">ScalatraBootstrap</span> <span class="n">exntends</span> <span class="nc">SkinnyLifeCycle</span> <span class="o">{</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">initSkinnyApp</span><span class="o">(</span><span class="n">ctx</span><span class="k">:</span> <span class="kt">ServletContext</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">mount</span><span class="o">(</span><span class="k">new</span> <span class="nc">TxPerRequestFilter</span><span class="o">,</span> <span class="s">"/*"</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre>

<p>And then your ORM models can retrieve the current DB session as a thread-local value per request, so you don&rsquo;t need to pass <code>DBSession</code> value as an implicit parameter in each method. </p>
<pre class="highlight scala"><span class="k">def</span> <span class="n">findAllByGroupId</span><span class="o">(</span><span class="n">groupId</span><span class="k">:</span> <span class="kt">Long</span><span class="o">)</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Member</span><span class="o">]</span> <span class="k">=</span> <span class="n">findAllBy</span><span class="o">(</span><span class="n">sqls</span><span class="o">.</span><span class="n">eq</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="n">groupId</span><span class="o">,</span> <span class="n">groupId</span><span class="o">)</span>
</pre>

<p>On the other hand, if you work with multiple threads for single HTTP request, you should be aware that the thread-local DB session won&rsquo;t be shared.</p>

<hr/>

<h3 id="using-non-numerical-or-typed-primary-key">Using Non-Numerical or Typed Primary Key</h3>

<hr/>

<p>SkinnyMapper expects a Long (bigint) value named <code>id</code> for primary key column.</p>

<p>If your application uses a non-numerical primary key for some reason, use <code>****WithId</code> traits instead. In this case, you must implement <code>idToRawValue</code> and <code>rawValueToId</code> methods.</p>

<p>If you need to use a complex object (e.g. <code>MemberId</code> class) as a primary key, it&rsquo;s also easy to implement.</p>
<pre class="highlight scala"><span class="k">case</span> <span class="k">class</span> <span class="nc">MemberId</span><span class="o">(</span><span class="n">value</span><span class="k">:</span> <span class="kt">Long</span><span class="o">)</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Member</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">MemberId</span><span class="o">,</span> <span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span>

<span class="k">object</span> <span class="nc">Member</span> <span class="k">extends</span> <span class="nc">SkinnyCRUDMapperWithId</span><span class="o">[</span><span class="kt">MemberId</span>, <span class="kt">Member</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">defaultAlias</span> <span class="k">=</span> <span class="n">createAlias</span><span class="o">(</span><span class="s">"m"</span><span class="o">)</span>

  <span class="k">override</span> <span class="k">def</span> <span class="n">idToRawValue</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">MemberId</span><span class="o">)</span> <span class="k">=</span> <span class="n">id</span><span class="o">.</span><span class="n">value</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">rawValueToId</span><span class="o">(</span><span class="n">v</span><span class="k">:</span> <span class="kt">Any</span><span class="o">)</span> <span class="k">=</span> <span class="nc">MemberId</span><span class="o">(</span><span class="n">v</span><span class="o">.</span><span class="n">toString</span><span class="o">.</span><span class="n">toLong</span><span class="o">)</span>

  <span class="k">def</span> <span class="n">extract</span><span class="o">(</span><span class="n">rs</span><span class="k">:</span> <span class="kt">WrappedResultSet</span><span class="o">,</span> <span class="n">m</span><span class="k">:</span> <span class="kt">ResultName</span><span class="o">[</span><span class="kt">Member</span><span class="o">])</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Member</span><span class="o">(</span>
    <span class="n">id</span> <span class="k">=</span> <span class="n">rawValueToId</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="n">string</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="n">id</span><span class="o">)),</span>
    <span class="n">name</span> <span class="k">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">string</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="n">name</span><span class="o">)</span>
  <span class="o">)</span>
<span class="o">}</span>
</pre>

<p>And your SkinnyResource will be like this:</p>
<pre class="highlight scala"><span class="k">package</span> <span class="nn">controller</span>
<span class="k">import</span> <span class="nn">skinny._</span>
<span class="k">import</span> <span class="nn">skinny.validator._</span>
<span class="k">import</span> <span class="nn">model._</span>

<span class="k">object</span> <span class="nc">CompaniesController</span> <span class="k">extends</span> <span class="nc">SkinnyResourceWithId</span><span class="o">[</span><span class="kt">CompanyId</span><span class="o">]</span> <span class="k">with</span> <span class="nc">ApplicationController</span> <span class="o">{</span>
  <span class="n">protectFromForgery</span><span class="o">()</span>

  <span class="k">implicit</span> <span class="k">override</span> <span class="k">val</span> <span class="n">scalatraParamsIdTypeConverter</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">TypeConverter</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">CompanyId</span><span class="o">]</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">apply</span><span class="o">(</span><span class="n">s</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">CompanyId</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Option</span><span class="o">(</span><span class="n">s</span><span class="o">).</span><span class="n">map</span><span class="o">(</span><span class="n">model</span><span class="o">.</span><span class="n">rawValueToId</span><span class="o">)</span>
  <span class="o">}</span>

  <span class="k">override</span> <span class="k">def</span> <span class="n">model</span> <span class="k">=</span> <span class="nc">Company</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">resourcesName</span> <span class="k">=</span> <span class="s">"companies"</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">resourceName</span> <span class="k">=</span> <span class="s">"company"</span>

  <span class="k">override</span> <span class="k">def</span> <span class="n">createParams</span> <span class="k">=</span> <span class="nc">Params</span><span class="o">(</span><span class="n">params</span><span class="o">).</span><span class="n">withDateTime</span><span class="o">(</span><span class="s">"updatedAt"</span><span class="o">)</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">createForm</span> <span class="k">=</span> <span class="n">validation</span><span class="o">(</span><span class="n">createParams</span><span class="o">,</span>
    <span class="n">paramKey</span><span class="o">(</span><span class="s">"name"</span><span class="o">)</span> <span class="n">is</span> <span class="n">required</span> <span class="o">&amp;</span> <span class="n">maxLength</span><span class="o">(</span><span class="mi">64</span><span class="o">),</span>
    <span class="n">paramKey</span><span class="o">(</span><span class="s">"url"</span><span class="o">)</span> <span class="n">is</span> <span class="n">maxLength</span><span class="o">(</span><span class="mi">128</span><span class="o">)</span>
  <span class="o">)</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">createFormStrongParameters</span> <span class="k">=</span> <span class="nc">Seq</span><span class="o">(</span>
    <span class="s">"name"</span> <span class="o">-&gt;</span> <span class="nc">ParamType</span><span class="o">.</span><span class="nc">String</span><span class="o">,</span> <span class="s">"url"</span> <span class="o">-&gt;</span> <span class="nc">ParamType</span><span class="o">.</span><span class="nc">String</span><span class="o">)</span>

  <span class="k">override</span> <span class="k">def</span> <span class="n">updateParams</span> <span class="k">=</span> <span class="nc">Params</span><span class="o">(</span><span class="n">params</span><span class="o">).</span><span class="n">withDateTime</span><span class="o">(</span><span class="s">"updatedAt"</span><span class="o">)</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">updateForm</span> <span class="k">=</span> <span class="n">validation</span><span class="o">(</span><span class="n">updateParams</span><span class="o">,</span>
    <span class="n">paramKey</span><span class="o">(</span><span class="s">"name"</span><span class="o">)</span> <span class="n">is</span> <span class="n">required</span> <span class="o">&amp;</span> <span class="n">maxLength</span><span class="o">(</span><span class="mi">64</span><span class="o">),</span>
    <span class="n">paramKey</span><span class="o">(</span><span class="s">"url"</span><span class="o">)</span> <span class="n">is</span> <span class="n">maxLength</span><span class="o">(</span><span class="mi">128</span><span class="o">)</span>
  <span class="o">)</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">updateFormStrongParameters</span> <span class="k">=</span> <span class="nc">Seq</span><span class="o">(</span>
    <span class="s">"name"</span> <span class="o">-&gt;</span> <span class="nc">ParamType</span><span class="o">.</span><span class="nc">String</span><span class="o">,</span> <span class="s">"url"</span> <span class="o">-&gt;</span> <span class="nc">ParamType</span><span class="o">.</span><span class="nc">String</span><span class="o">)</span>
<span class="o">}</span>
</pre>

<p>If you use an alternative Id generator instead of the RDB&rsquo;s auto-incremental value, set <code>useExternalIdGenerator</code> as true and implement the <code>generateId</code> method.</p>
<pre class="highlight scala"><span class="k">case</span> <span class="k">class</span> <span class="nc">Member</span><span class="o">(</span><span class="n">uuid</span><span class="k">:</span> <span class="kt">UUID</span><span class="o">,</span> <span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span>

<span class="k">object</span> <span class="nc">Member</span> <span class="k">extends</span> <span class="nc">SkinnyCRUDMapperWithId</span><span class="o">[</span><span class="kt">UUID</span>, <span class="kt">Member</span><span class="o">]</span> 
  <span class="k">with</span> <span class="nc">SoftDeleteWithBooleanFeatureWithId</span><span class="o">[</span><span class="kt">UUID</span>, <span class="kt">Member</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">defaultAlias</span> <span class="k">=</span> <span class="n">createAlias</span><span class="o">(</span><span class="s">"m"</span><span class="o">)</span>

  <span class="k">override</span> <span class="k">def</span> <span class="n">primaryKeyFieldName</span> <span class="k">=</span> <span class="s">"uuid"</span>

  <span class="c1">// use alternative id generator instead of DB's auto-increment
</span>  <span class="k">override</span> <span class="k">def</span> <span class="n">useExternalIdGenerator</span> <span class="k">=</span> <span class="kc">true</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">generateId</span> <span class="k">=</span> <span class="nc">UUID</span><span class="o">.</span><span class="n">randomUUID</span>

  <span class="k">override</span> <span class="k">def</span> <span class="n">idToRawValue</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">UUID</span><span class="o">)</span> <span class="k">=</span> <span class="n">id</span><span class="o">.</span><span class="n">toString</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">rawValueToId</span><span class="o">(</span><span class="n">value</span><span class="k">:</span> <span class="kt">Any</span><span class="o">)</span> <span class="k">=</span> <span class="nc">UUID</span><span class="o">.</span><span class="n">fromString</span><span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="n">toString</span><span class="o">)</span>

  <span class="k">def</span> <span class="n">extract</span><span class="o">(</span><span class="n">rs</span><span class="k">:</span> <span class="kt">WrappedResultSet</span><span class="o">,</span> <span class="n">m</span><span class="k">:</span> <span class="kt">ResultName</span><span class="o">[</span><span class="kt">Member</span><span class="o">])</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Member</span><span class="o">(</span>
    <span class="n">uuid</span> <span class="k">=</span> <span class="n">rawValueToId</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="n">string</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="n">uuid</span><span class="o">)),</span>
    <span class="n">name</span> <span class="k">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">string</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="n">name</span><span class="o">)</span>
  <span class="o">)</span>
<span class="o">}</span>

<span class="k">val</span> <span class="n">m</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Member</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Memmber</span><span class="o">.</span><span class="n">findById</span><span class="o">(</span><span class="nc">UUID</span><span class="o">.</span><span class="n">fromString</span><span class="o">(</span><span class="s">"....."</span><span class="o">))</span>
</pre>

<p>Don&rsquo;t worry. Skinny-ORM does well at resolving associations even if you use custom primary keys.</p>

<hr/>

<h3 id="activerecord-like-timestamps">ActiveRecord-like Timestamps</h3>

<hr/>

<p><code>timetamps</code> from ActiveRecord is available as the <code>TimestampsFeature</code> trait. </p>

<p>By default, this trait expects two columns on the table - <code>created_at timestamp not null</code> and <code>updated_at timestamp</code>. If you need customizing, override *FieldName methods as follows.</p>
<pre class="highlight scala"><span class="k">class</span> <span class="nc">Member</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">Long</span><span class="o">,</span> <span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">createdAt</span><span class="k">:</span> <span class="kt">DateTime</span><span class="o">,</span> <span class="n">updatedAt</span><span class="k">:</span> <span class="kt">DateTime</span><span class="o">)</span>

<span class="k">object</span> <span class="nc">Member</span> <span class="k">extends</span> <span class="nc">SkinnyCRUDMapper</span><span class="o">[</span><span class="kt">Member</span><span class="o">]</span> <span class="k">with</span> <span class="nc">TimestampsFeature</span><span class="o">[</span><span class="kt">Member</span><span class="o">]</span> <span class="o">{</span>

  <span class="c1">// created_timestamp
</span>  <span class="k">override</span> <span class="k">def</span> <span class="n">createdAtFieldName</span> <span class="k">=</span> <span class="s">"createdTimestamp"</span>
  <span class="c1">// updated_timestamp
</span>  <span class="k">override</span> <span class="k">def</span> <span class="n">updatedAtFieldName</span> <span class="k">=</span> <span class="s">"updatedTimestamp"</span>
<span class="o">}</span>
</pre>

<p>Source code: 
<a href="https://github.com/skinny-framework/skinny-framework/blob/master/orm/src/main/scala/skinny/orm/feature/TimestampsFeature.scala">https://github.com/skinny-framework/skinny-framework/blob/master/orm/src/main/scala/skinny/orm/feature/TimestampsFeature.scala</a></p>

<hr/>

<h3 id="soft-deletion">Soft Deletion</h3>

<hr/>

<p>Soft delete support is also available. </p>

<p>By default, <code>deleted_at timestamp</code> column or <code>is_deleted boolean not null</code> is expected.</p>
<pre class="highlight scala"><span class="k">object</span> <span class="nc">Member</span> <span class="k">extends</span> <span class="nc">SkinnyCRUDMapper</span><span class="o">[</span><span class="kt">Member</span><span class="o">]</span>
  <span class="k">with</span> <span class="nc">SoftDeleteWithTimestampFeature</span><span class="o">[</span><span class="kt">Member</span><span class="o">]</span> <span class="o">{</span>

  <span class="c1">// deleted_timestamp timestamp
</span>  <span class="k">override</span> <span class="k">val</span> <span class="n">deletedAtFieldName</span> <span class="k">=</span> <span class="s">"deletedTimestamp"</span>
<span class="o">}</span>
</pre>

<p>Source code: 
<a href="https://github.com/skinny-framework/skinny-framework/blob/master/orm/src/main/scala/skinny/orm/feature/SoftDeleteWithBooleanFeature.scala">https://github.com/skinny-framework/skinny-framework/blob/master/orm/src/main/scala/skinny/orm/feature/SoftDeleteWithBooleanFeature.scala</a></p>

<p>Source code: 
<a href="https://github.com/skinny-framework/skinny-framework/blob/master/orm/src/main/scala/skinny/orm/feature/SoftDeleteWithTimestampFeature.scala">https://github.com/skinny-framework/skinny-framework/blob/master/orm/src/main/scala/skinny/orm/feature/SoftDeleteWithTimestampFeature.scala</a></p>

<hr/>

<h3 id="optimistic-lock">Optimistic Lock</h3>

<hr/>

<p>Furthermore, optimistic lock is also available. </p>

<p>By default, <code>lock_version bigint not null</code> or <code>lock_timestamp timestamp</code> is expected</p>
<pre class="highlight scala"><span class="k">object</span> <span class="nc">Member</span> <span class="k">extends</span> <span class="nc">SkinnyCRUDMapper</span><span class="o">[</span><span class="kt">Member</span><span class="o">]</span>
  <span class="k">with</span> <span class="nc">OptimisticLockWithVersionFeature</span><span class="o">[</span><span class="kt">Member</span><span class="o">]</span>
<span class="c1">// lock_version bigint
</span></pre>

<p>Source code: 
<a href="https://github.com/skinny-framework/skinny-framework/blob/master/orm/src/main/scala/skinny/orm/feature/OptimisticLockWithVersionFeature.scala">https://github.com/skinny-framework/skinny-framework/blob/master/orm/src/main/scala/skinny/orm/feature/OptimisticLockWithVersionFeature.scala</a></p>

<p>Source code: 
<a href="https://github.com/skinny-framework/skinny-framework/blob/master/orm/src/main/scala/skinny/orm/feature/OptimisticLockWithTimestampFeature.scala">https://github.com/skinny-framework/skinny-framework/blob/master/orm/src/main/scala/skinny/orm/feature/OptimisticLockWithTimestampFeature.scala</a></p>

<hr/>

<h3 id="factorygirl">FactoryGirl</h3>

<hr/>

<p>An easy-to-use fixture tool named FactoryGirl makes testing easy.</p>

<p>See in detail here: <a href="/documentation/factory-girl.html">FactoryGirl</a></p>

<hr/>

<h2 id="faq">FAQ</h2>

<hr/>

<h3 id="unexpectednullvalueexception">UnexpectedNullValueException</h3>

<p>If you see the following exception, your application code using Skinny ORM has a bug. This is not a framework bug.</p>
<pre class="highlight plaintext">Caused by: scalikejdbc.UnexpectedNullValueException: null
  at scalikejdbc.TypeBinder$.scalikejdbc$TypeBinder$$throwExceptionIfNull(TypeBinder.scala:140) ~[scalikejdbc_2.10-1.7.4.jar:1.7.4]
  at scalikejdbc.TypeBinder$$anonfun$38.apply(TypeBinder.scala:82) ~[scalikejdbc_2.10-1.7.4.jar:1.7.4]
  at scalikejdbc.TypeBinder$$anonfun$38.apply(TypeBinder.scala:82) ~[scalikejdbc_2.10-1.7.4.jar:1.7.4]
...
</pre>

<h4 id="typical-example">Typical Example</h4>

<p>Typically, the following code will throw UnexpectedNullValueException when the <code>groupId</code> is null.</p>
<pre class="highlight plaintext">create table member (
  id serial primary key,
  name varchar(256) not null,
  groupId integer
  created_at timestamp not null
  updated_at timestamp not null
);
</pre>
<pre class="highlight scala"><span class="k">case</span> <span class="k">class</span> <span class="nc">Member</span><span class="o">(</span>
  <span class="n">id</span><span class="k">:</span> <span class="kt">Long</span><span class="o">,</span>
  <span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
  <span class="n">groupId</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span>
  <span class="n">createdAt</span><span class="k">:</span> <span class="kt">DateTime</span><span class="o">,</span>
  <span class="n">updatedAT</span><span class="k">:</span> <span class="kt">DateTime</span><span class="o">)</span>

<span class="k">object</span> <span class="nc">Member</span> <span class="k">extends</span> <span class="nc">SkinnyCRUDMapper</span><span class="o">[</span><span class="kt">Member</span><span class="o">]</span> <span class="k">with</span> <span class="nc">TimestampsFeature</span><span class="o">[</span><span class="kt">Member</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">defaultAlias</span> <span class="k">=</span> <span class="n">createAlias</span><span class="o">(</span><span class="s">"m"</span><span class="o">)</span>

  <span class="k">override</span> <span class="k">def</span> <span class="n">extract</span><span class="o">(</span><span class="n">rs</span><span class="k">:</span> <span class="kt">WrappedResultSet</span><span class="o">,</span> <span class="n">n</span><span class="k">:</span> <span class="kt">ResultName</span><span class="o">[</span><span class="kt">Member</span><span class="o">])</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Member</span><span class="o">(</span>
    <span class="n">id</span> <span class="k">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">long</span><span class="o">(</span><span class="n">n</span><span class="o">.</span><span class="n">id</span><span class="o">),</span> 
    <span class="n">name</span> <span class="k">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">string</span><span class="o">(</span><span class="n">n</span><span class="o">.</span><span class="n">name</span><span class="o">),</span>
    <span class="n">groupId</span> <span class="k">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">int</span><span class="o">(</span><span class="n">n</span><span class="o">.</span><span class="n">groupId</span><span class="o">),</span> <span class="c1">// nullable but scala.Int is not nullable!!!
</span>    <span class="n">createdAt</span> <span class="k">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">dateTime</span><span class="o">(</span><span class="n">n</span><span class="o">.</span><span class="n">name</span><span class="o">),</span>
    <span class="n">updatedAt</span> <span class="k">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">dateTime</span><span class="o">(</span><span class="n">n</span><span class="o">.</span><span class="n">name</span><span class="o">),</span>
  <span class="o">)</span>
<span class="o">}</span>
</pre>

<p>You must update <code>Member</code> class as follows:</p>
<pre class="highlight scala"><span class="k">case</span> <span class="k">class</span> <span class="nc">Member</span><span class="o">(</span>
  <span class="n">id</span><span class="k">:</span> <span class="kt">Long</span><span class="o">,</span>
  <span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
  <span class="c1">//groupId: Int,
</span>  <span class="n">groupId</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Int</span><span class="o">],</span>
  <span class="n">createdAt</span><span class="k">:</span> <span class="kt">DateTime</span><span class="o">,</span>
  <span class="n">updatedAT</span><span class="k">:</span> <span class="kt">DateTime</span><span class="o">)</span>
</pre>

            <hr/>
            <div class="alert alert-info small"> 
              If you find a typo or mistake in this page, please report or fix it. <a href="/contribution.html">How?</a>
            </div> 

<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=658247244206928";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<div class="fb-like" data-href="http://skinny-framework.org/" data-layout="standard" data-action="recommend" data-show-faces="true" data-share="true"></div>

<a href="https://twitter.com/skinnyframework" class="twitter-follow-button" data-show-count="false">Follow @skinnyframework</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

<a href="https://twitter.com/share" class="twitter-share-button" data-url="http://skinny-framework.org/" data-text="#Scala on #Rails" data-via="skinnyframework">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
</a>

          </div>
        </div>
      </div>
    </div>
    <script type="text/javascript" src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
  </body>
</html>

